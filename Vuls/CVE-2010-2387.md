## Summary:  
Software: gnome_display_manager  
## Fix:  
Commit: https://github.com/GNOME/gdm/commit/f5ae896723027633cbf4f21523ce7eb250431fd7  
Change Size: +43 -30  
Fix Time (of the Last Commit): 2010-06-02  
Author: Brian Cameron <brian.cameron@sun.com>  
Fix Pattern: Remove -> Logging Variables  
MISC: https://mail.gnome.org/archives/commits-list/2010-June/msg00542.html  
  
Fixing-commits Count: 1  
Total Change Size: +43 -30  
  
  
```diff  
--- ve-misc.c-orig	2010-05-13 19:57:46.775441219 -0500  
+++ ve-misc.c	2010-05-13 19:58:09.020677410 -0500  
@@ -257,7 +257,7 @@ ve_locale_to_utf8 (const char *str)  
 {  
 	char *ret = g_locale_to_utf8 (str, -1, NULL, NULL, NULL);  
 	if (ret == NULL) {  
-		g_warning ("string not in proper locale encoding: \"%s\"", str);  
+		g_warning ("string not in proper locale encoding");  
 		return g_strdup (str);  
 	} else {  
 		return ret;  
@@ -269,7 +269,7 @@ ve_locale_from_utf8 (const char *str)  
 {  
 	char *ret = g_locale_from_utf8 (str, -1, NULL, NULL, NULL);  
 	if (ret == NULL) {  
-		g_warning ("string not in proper utf8 encoding: \"%s\"", str);  
+		g_warning ("string not in proper utf8 encoding");  
 		return g_strdup (str);  
 	} else {  
 		return ret;  
@@ -281,7 +281,7 @@ ve_filename_to_utf8 (const char *str)  
 {  
 	char *ret = g_filename_to_utf8 (str, -1, NULL, NULL, NULL);  
 	if (ret == NULL) {  
-		g_warning ("string not in proper locale encoding: \"%s\"", str);  
+		g_warning ("string not in proper locale encoding");  
 		return g_strdup (str);  
 	} else {  
 		return ret;  
@@ -293,7 +293,7 @@ ve_filename_from_utf8 (const char *str)  
 {  
 	char *ret = g_filename_from_utf8 (str, -1, NULL, NULL, NULL);  
 	if (ret == NULL) {  
-		g_warning ("string not in proper utf8 encoding: \"%s\"", str);  
+		g_warning ("string not in proper utf8 encoding");  
 		return g_strdup (str);  
 	} else {  
 		return ret;  
```  
## Sample logs: Yes  
```  
Feb 15 16:14:54 foostation gdmlogin[20771]: WARNING: string not in proper utf8 encoding: "pwd@\M-C\240@\M-C\240"  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> user password  
### Sink labels:  
#### Sink 1:  
Logging call Function:  Third-party Libaries（Glib Logging）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules (https://github.com/GNOME/gdm/blob/2799f52e01354944c0f464aa93bc5adfbc6bc0e8/daemon/slave.c#L1239) -> Type Names（passwd）  
#### Sink 2:  
Logging call Function:  Third-party Libaries（Glib Logging）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules (https://github.com/GNOME/gdm/blob/2799f52e01354944c0f464aa93bc5adfbc6bc0e8/daemon/slave.c#L1239) -> Type Names（passwd）  
#### Sink 3:  
Logging call Function:  Third-party Libaries（Glib Logging）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules (https://github.com/GNOME/gdm/blob/2799f52e01354944c0f464aa93bc5adfbc6bc0e8/daemon/slave.c#L1239) -> Type Names（passwd）  
#### Sink 4:  
Logging call Function:  Third-party Libaries（Glib Logging）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules (https://github.com/GNOME/gdm/blob/2799f52e01354944c0f464aa93bc5adfbc6bc0e8/daemon/slave.c#L1239) -> Type Names（passwd）  
Programming Language:C/C++  
```C++  
// https://github.com/GNOME/gdm/blob/2799f52e01354944c0f464aa93bc5adfbc6bc0e8/gui/gdmlogin.c#L2816-L3312  
static void  
gdm_login_gui_init (void)  
  
// OMIT FOR SIMPLICITY  
  
    ok_button = gtk_button_new_from_stock (GTK_STOCK_OK);  
    g_signal_connect (G_OBJECT (ok_button), "clicked",  
		      G_CALLBACK (gdm_login_ok_button_press),  
		      entry); // HERE IS THE SOURCE  
    gtk_widget_show (ok_button);  
  
  
// https://github.com/GNOME/gdm/blob/2799f52e01354944c0f464aa93bc5adfbc6bc0e8/gui/gdmlogin.c#L1246-L1250  
static void  
gdm_login_ok_button_press (GtkButton *button, GtkWidget *entry)  
{  
	gdm_login_enter (entry); // HERE IS THE FLOW  
}  
  
  
// https://github.com/GNOME/gdm/blob/e491a3f0a6412b929fb9a20e2353742d2f6947ab/gui/gdmlogin.c#L850-L904  
  
static void  
gdm_login_enter (GtkWidget *entry)  
{  
	const char *login_string;  
	const char *str;  
	char *tmp;  
  
	if (entry == NULL)  
		return;  
  
	gtk_widget_set_sensitive (entry, FALSE);  
	gtk_widget_set_sensitive (ok_button, FALSE);  
	gtk_widget_set_sensitive (start_again_button, FALSE);  
  
	login_string = gtk_entry_get_text (GTK_ENTRY (entry));  
  
	str = gtk_label_get_text (GTK_LABEL (label));  
	if (str != NULL &&  
	    (strcmp (str, _("Username:")) == 0 ||  
	     strcmp (str, _("_Username:")) == 0) &&  
	    /* If in timed login mode, and if this is the login  
	     * entry.  Then an enter by itself is sort of like I want to  
	     * log in as the timed user, really.  */  
	    ve_string_empty (login_string) &&  
	    timed_handler_id != 0) {  
		/* timed interruption */  
		printf ("%c%c%c\n", STX, BEL, GDM_INTERRUPT_TIMED_LOGIN);  
		fflush (stdout);  
		return;  
	}  
  
	if (str != NULL &&  
	    (strcmp (str, _("Username:")) == 0 ||  
	     strcmp (str, _("_Username:")) == 0) &&  
	    /* evilness */  
	    evil (login_string)) {  
		/* obviously being 100% reliable is not an issue for  
		   this test */  
		gtk_widget_set_sensitive (entry, TRUE);  
		gtk_widget_grab_focus (entry);	  
		gtk_window_set_focus (GTK_WINDOW (login), entry);	  
		return;  
	}  
  
	/* clear the err_box */  
	if (err_box_clear_handler > 0)  
		g_source_remove (err_box_clear_handler);  
	err_box_clear_handler = 0;  
	gtk_label_set_text (GTK_LABEL (err_box), "");  
  
	tmp = ve_locale_from_utf8 (gtk_entry_get_text (GTK_ENTRY (entry)));  
	printf ("%c%s\n", STX, tmp);  
	fflush (stdout);  
	g_free (tmp);  
}  
  
// https://github.com/GNOME/genius/blob/master/ve/ve-misc.c#L251-L297  
char *  
ve_locale_to_utf8 (const char *str)  
{  
	char *ret = g_locale_to_utf8 (str, -1, NULL, NULL, NULL);  
	if (ret == NULL) {  
		g_warning ("string not in proper locale encoding: \"%s\"", str); // HERE IS THE SINK 1  
		return g_strdup (str);  
	} else {  
		return ret;  
	}  
}  
  
char *  
ve_locale_from_utf8 (const char *str)  
{  
	char *ret = g_locale_from_utf8 (str, -1, NULL, NULL, NULL);  
	if (ret == NULL) {  
		g_warning ("string not in proper utf8 encoding: \"%s\"", str); // HERE IS THE SINK 2  
		return g_strdup (str);  
	} else {  
		return ret;  
	}  
}  
  
char *  
ve_filename_to_utf8 (const char *str)  
{  
	char *ret = g_filename_to_utf8 (str, -1, NULL, NULL, NULL);  
	if (ret == NULL) {  
		g_warning ("string not in proper locale encoding: \"%s\"", str); // HERE IS THE SINK 3  
		return g_strdup (str);  
	} else {  
		return ret;  
	}  
}  
  
char *  
ve_filename_from_utf8 (const char *str)  
{  
	char *ret = g_filename_from_utf8 (str, -1, NULL, NULL, NULL);  
	if (ret == NULL) {  
		g_warning ("string not in proper utf8 encoding: \"%s\"", str); // HERE IS THE SINK 4  
		return g_strdup (str);  
	} else {  
		return ret;  
	}  
}  
  
// https://github.com/GNOME/glib/blob/3088fbae521db963281c3fb1fb136f1f021d4726/glib/gmessages.h#L320-L322  
  
#define g_warning(...)  g_log_structured_standard (G_LOG_DOMAIN, G_LOG_LEVEL_WARNING, \  
                                                   __FILE__, G_STRINGIFY (__LINE__), \  
                                                   G_STRFUNC, __VA_ARGS__)  
  
// https://github.com/GNOME/glib/blob/3088fbae521db963281c3fb1fb136f1f021d4726/glib/gmessages.c#L1969-L2020  
  
/* Semi-private helper function to implement the g_message() (etc.) macros  
 * with support for G_GNUC_PRINTF so that @message_format can be checked  
 * with -Wformat. */  
void  
g_log_structured_standard (const gchar    *log_domain,  
                           GLogLevelFlags  log_level,  
                           const gchar    *file,  
                           const gchar    *line,  
                           const gchar    *func,  
                           const gchar    *message_format,  
                           ...)  
{  
  GLogField fields[] =  
    {  
      { "PRIORITY", log_level_to_priority (log_level), -1 },  
      { "CODE_FILE", file, -1 },  
      { "CODE_LINE", line, -1 },  
      { "CODE_FUNC", func, -1 },  
      /* Filled in later: */  
      { "MESSAGE", NULL, -1 },  
      /* If @log_domain is %NULL, we will not pass this field: */  
      { "GLIB_DOMAIN", log_domain, -1 },  
    };  
  gsize n_fields;  
  gchar *message_allocated = NULL;  
  gchar buffer[1025];  
  va_list args;  
  
  va_start (args, message_format);  
  
  if (log_level & G_LOG_FLAG_RECURSION)  
    {  
      /* we use a stack buffer of fixed size, since we're likely  
       * in an out-of-memory situation  
       */  
      gsize size G_GNUC_UNUSED;  
  
      size = _g_vsnprintf (buffer, sizeof (buffer), message_format, args);  
      fields[4].value = buffer;  
    }  
  else  
    {  
      fields[4].value = message_allocated = g_strdup_vprintf (message_format, args);  
    }  
  
  va_end (args);  
  
  n_fields = G_N_ELEMENTS (fields) - ((log_domain == NULL) ? 1 : 0);  
  g_log_structured_array (log_level, fields, n_fields);  
  
  g_free (message_allocated);  
}  
  
```  
