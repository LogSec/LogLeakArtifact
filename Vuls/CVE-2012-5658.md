## Summary:  
Software: openshift  
## Fix:  
Commit: https://github.com/openshift/rhc/commit/54d7e6bc54818efb32f924f91be124078f1607e4  
Fix Time (of the Last Commit): 2012-12-20  
Author: Hiro Asari  
Fix Pattern: Sanitization -> Redaction -> Introduction -> KeywordBasedFiltration -> RedactionFunctionDefined  
  
  
Fixing-commits Count: 4  
Total Change Size: +23 -12  
  
========  
PR: https://github.com/openshift/rhc/pull/261 | https://github.com/openshift/rhc/pull/264  
  
Commit: https://github.com/openshift/rhc/commit/ec75ef6a0dbe9f378d09afc57ede8fd1d97ce042  
Change Size: +19 -10  
Time: 2012-12-19  
Author: Hiro Asari  
Commit: https://github.com/openshift/rhc/commit/20af5a8feed8f2f3874bfa41e35d81642841b76e  
Change Size: +2 -0  
Time: 2012-12-19  
Author: Hiro Asari  
Commit: https://github.com/openshift/rhc/commit/31a90eb7f510c08b8e93245d4879583a5eb1e327  
Change Size: +1 -1  
Time: 2012-12-19  
Author: Hiro Asari  
Commit: https://github.com/openshift/rhc/commit/54d7e6bc54818efb32f924f91be124078f1607e4  
Change Size: +1 -1  
Time: 2012-12-20  
Author: Hiro Asari  
## Sample logs: Yes  
```Yaml  
- https://ec2-204-236-207-80.compute-1.amazonaws.com/broker/userinfo:   
    body:   
      api: 1.1.3  
      data:   
        app_info:   
          php1s:   
            framework: php-5.3  
            creation_time: "2012-12-20T02:33:16-05:00"  
            embedded:   
              mongodb-2.2:   
                connection_url: mongodb://8b4a14e566-2613t2.dev.rhcloud.com:35591/  
                password: pA1lWjMM_B7Z  
                database_name: php1s  
                username: admin  
                info: "Connection URL: mongodb://8b4a14e566-2613t2.dev.rhcloud.com:35591/"  
              haproxy-1.4:   
                info: ""  
            uuid: 02f8cb4a669e4fa3aec94e85abd8f569  
            aliases:   
          ews1:   
            framework: jbossews-1.0  
            creation_time: "2012-12-20T02:38:43-05:00"  
            embedded:   
              mysql-5.1:   
                connection_url: mysql://127.1.2.129:3306/  
                password: 4ujyRP5USdxX  
                database_name: ews1  
                username: admin  
                info: "Connection URL: mysql://127.1.2.129:3306/"  
            uuid: 440152af3f0647b99cb47eeb758740c7  
            aliases:   
          perl1s:   
            framework: perl-5.10  
            creation_time: "2012-12-20T04:15:48-05:00"  
            embedded:   
              mongodb-2.2:   
                connection_url: mongodb://d9164996d8-2613t2.dev.rhcloud.com:35671/  
                password: Xs7jgMRI7e34  
                database_name: perl1s  
                username: admin  
                info: "Connection URL: mongodb://d9164996d8-2613t2.dev.rhcloud.com:35671/"  
              haproxy-1.4:   
                info: ""  
            uuid: ab9336eff9c14fe78612a723dfa77d87  
            aliases:   
          zend1:   
            framework: zend-5.6  
            creation_time: "2012-12-20T02:41:16-05:00"  
            embedded: {}  
  
            uuid: 76bb3db240874b7aaf4c77b3b528f094  
            aliases:   
          eap1:   
            framework: jbosseap-6.0  
            creation_time: "2012-12-20T02:58:00-05:00"  
            embedded:   
              mysql-5.1:   
                connection_url: mysql://127.1.3.1:3306/  
                password: l_jAeqeh5hm1  
                database_name: eap1  
                username: admin  
                info: "Connection URL: mysql://127.1.3.1:3306/"  
              postgresql-8.4:   
                connection_url: postgresql://127.1.3.1:5432/  
                password: aGRgklG16IJ_  
                database_name: eap1  
                username: admin  
                info: "Connection URL: postgresql://127.1.3.1:5432/"  
            uuid: 5cd61db5a2614910970ae22e5d770ff9  
            aliases:   
        user_info:   
          ssh_key: AAAAB3NzaC1yc2EAAAABIwAAAQEA5NhuwVsYZ3cWW0pDa2CCOxza+8v5Vjl9asHXuVnSJn3z9ze2UvAbJtL7/9U1SplODRR5pKIBNbSy1wou43uRJvUMjKwr605zimifVSBXAVo5R/kASe0XmwFCdW8ppzd4S/wnWlGqtJBoISq1E/NvgB9lmF4XzmlkxkEX0W/mlrVSHUGSS3i9YHbcB6rCmHja9HF/9ujXxsE2x5S8SR1KFsl8jHMnc5z++tnmaldK6ehWVZBrz71F4D7lcyOs1ecCBhI+egwNdxBxD/5iND0ZcA2cSRHpcMC4xEpfyEXA3IK9oe1r3KssXzdce6GKIORG0/TnzpJEHKQlyQ53467CUQ==  
          consumed_gears: 10  
          env_vars:   
          rhc_domain: dev.rhcloud.com  
          ssh_type: ssh-rsa  
          uuid: 11e693b2ee244a5ca1120adb9d427461  
          ssh_keys:   
            jhou1rheltest:   
              key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDtCmYXHoRk6PdGXs6OfCUYoVqaFXR3v2ZnWXqjhirKG2N8ISFtgVtH2qh9JwnEwLdbBJjkYDVHeehR4DhYIeWM2F073tScQGB9hMYi97X8oVnq2pmFDLkwWW/lXonjW/i7IQAXQ4VjFJn1mkxestT/TI573dZXecRCqtFOwnir2ygemrN1UBysDTpolGovGVpgHefoIkzoo3n76/MSR+ZtpnUqnohdIj/PE9OK+VzRfpF8GsDMXgzUjxkY1KX9WhDlpeoL7M+NEI7czGOcgmAj1nyMkMauH0UFbojH3y/bcVd7ZurneORg6w4TcuYgL1crG2qywIXZLcxv5K14eZ1r  
              type: ssh-rsa  
            a2:   
              key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDOSBnYfKt1SLStpasRlrtbFUeJ7c8sFg1zGw8VXsCgooYtVNvIykmeJ5v1CUdSXM8E9LQ/WBzst+IGNSfOVg7PJCmmm/eO///X97yO+MuVlydYf+WEazAvUW0C4PrdnokbRDVhrpMBAwo8uH0bzxMaGWFBx0rIj2hw43yk2f/dXS/Vj+lmZAO1NScnDP4Vp4huboj31WYrUR/Sb8V3zGlsR2w2/TsqU+jsAU7kRbHmIulCDIJTOdjUFS/O7LcP11Cc/DuuHxLSq1UVvl8Be/urZGoLdX8obbOBzqEncsLR60qYj8aDrSngQKa1KDj+td7FqgegQbInXxYVXVJMWaXx  
              type: ssh-rsa  
            a1:   
              key: AAAAB3NzaC1yc2EAAAADAQABAAABAQDKkl6c1D5qW6AlWswXg5PsoraB5bqUJlOZlTiFpIN5JgAfYj6n3pOle1+qoK0NWoohHZcjRwY+BlI+0g5D+IK8KTMw53CweJ21BAvHRZSgTNmm8EIdl7l9EeBy+pk+mcycY4hXVAp+2tQeO5Y4t52dLoqZDAqhjYbLesoYAxDwPgMxjPBZN9x00FMJ0qdxl+YVWaZICDDz8DWaiGEUJwWu6AbYgaKzDXZlElgVXvMuIIyJaGyUxPl812932uYF9vRgsBuVwTBIx9cSLl11EmNp18fjCOYMd+YmUjzSmWiy9kxAFIiS49IsKErCITYvuB/IbHLu4QTotQyQ3LhvzUFp  
              type: ssh-rsa  
            default:   
              key: AAAAB3NzaC1yc2EAAAABIwAAAQEA5NhuwVsYZ3cWW0pDa2CCOxza+8v5Vjl9asHXuVnSJn3z9ze2UvAbJtL7/9U1SplODRR5pKIBNbSy1wou43uRJvUMjKwr605zimifVSBXAVo5R/kASe0XmwFCdW8ppzd4S/wnWlGqtJBoISq1E/NvgB9lmF4XzmlkxkEX0W/mlrVSHUGSS3i9YHbcB6rCmHja9HF/9ujXxsE2x5S8SR1KFsl8jHMnc5z++tnmaldK6ehWVZBrz71F4D7lcyOs1ecCBhI+egwNdxBxD/5iND0ZcA2cSRHpcMC4xEpfyEXA3IK9oe1r3KssXzdce6GKIORG0/TnzpJEHKQlyQ53467CUQ==  
              type: ssh-rsa  
          max_gears: 100  
          rhlogin: jhou+1@redhat.com  
          parent_user_login:   
          domains:   
          - uuid: 5b3f785d5d4a43029bfde7b8eacb326d  
            namespace: 2613t2  
          system_ssh_keys:   
          capabilities:   
            gear_sizes:   
            - small  
          namespace: 2613t2  
      broker_c:   
      - namespace  
      - rhlogin  
      - ssh  
      - app_uuid  
      - debug  
      - alter  
      - cartridge  
      - cart_type  
      - action  
      - app_name  
      - api  
      messages: ""  
      debug: ""  
      exit_code: 0  
      result: ""  
      api_c:   
      - placeholder  
    header:   
      etag:   
      - "\"e6e5681ce88dba246811391f1e85d893\""  
      x-powered-by:   
      - Phusion Passenger (mod_rails/mod_rack) 3.0.12  
      content-type:   
      - application/json; charset=utf-8  
      x-rack-cache:   
      - invalidate, pass  
      cache-control:   
      - max-age=0, private, must-revalidate  
      x-ua-compatible:   
      - IE=Edge  
      date:   
      - Thu, 20 Dec 2012 09:33:41 GMT  
      proxytime:   
      - D=570927  
      strict-transport-security:   
      - max-age=15768000, includeSubDomains  
      set-cookie:   
      - _rhc_broker_session=BAh7BkkiD3Nlc3Npb25faWQGOgZFRkkiJTg2MGI5ZTk1NTU0ODFjYmNiOWU0MzZiZjlmZjU4MGU0BjsAVA%3D%3D--e2eb649c543cc1d438041ace50e4566b4b2e2904; path=/; secure; HttpOnly  
      x-request-id:   
      - f55b4d1d51d8d1b9fe94f62d55be99fd  
      server:   
      - Apache/2.2.15 (Red Hat)  
      status:   
      - "200"  
      x-runtime:   
      - "0.228332"  
      vary:   
      - Accept-Encoding,User-Agent  
      content-length:   
      - "4749"  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information: authentication data -> the password and other sensitive information  
### Sink labels:  
#### Sink 1:  
Logging call Function:  Standard Libraries（File.write）  
Sensitiveness-Identifiable Source:  Cross Projects(https://github.com/openshift/origin-server/blob/2fa96105fd5aacd90ac81c3df3fc92d7b520148d/cartridges/openshift-origin-cartridge-mongodb-2.2/info/manifest.yml#L19) -> Configurations  
Programming Language:Ruby  
```YAML  
# https://github.com/openshift/origin-server/blob/2fa96105fd5aacd90ac81c3df3fc92d7b520148d/cartridges/openshift-origin-cartridge-mongodb-2.2/info/manifest.yml#L1-L27  
Name: mongodb-2.2  
Display-Name: MongoDB NoSQL Database 2.2  
Description: "MongoDB is a scalable, high-performance, open source NoSQL database."  
Version: 2.2.0  
License: ASL 2.0  
License-Url: http://www.apache.org/licenses/LICENSE-2.0.txt  
Vendor: 10gen  
Categories:  
  - cartridge  
  - database  
  - nosql  
Website: http://www.10gen.com  
Help-Topics:  
  - "Building with MongoDB" : https://openshift.redhat.com/community/developers/mongodb  
Cart-Data:  
  - Key: "username"  
    Type: cart_data  
    Description: "Root user on mongo database"  
  - Key: "password"  
    Type: cart_data  
    Description: "Password for root user on mongo database"  
  - Key: database_name  
    Type: cart_data  
    Description: "Mongo DB name"  
  - Key: connection_url  
    Type: cart_data  
    Description: "Mongo DB connection URL"  
```  
```Ruby  
  
# https://github.com/openshift/origin-server/blob/2fa96105fd5aacd90ac81c3df3fc92d7b520148d/controller/app/models/application.rb#L5-L21  
class Application < OpenShift::Cartridge  
  attr_accessor :user, :creation_time, :uuid, :aliases, :cart_data,   
                :state, :group_instance_map, :comp_instance_map, :conn_endpoints_list,  
                :domain, :group_override_map, :working_comp_inst_hash,  
                :working_group_inst_hash, :configure_order, :start_order,  
                :scalable, :proxy_cartridge, :init_git_url, :node_profile,  
                :ssh_keys, :ngears, :usage_records, :destroyed_gears, :user_agent  
  primary_key :name  
  exclude_attributes :user, :comp_instance_map, :group_instance_map,  
                :working_comp_inst_hash, :working_group_inst_hash, :user_agent,  
                :group_override_map  
  include_attributes :comp_instances, :group_instances  
  
  APP_NAME_MAX_LENGTH = 32  
  DEFAULT_NODE_PROFILE = "small"  
  UNSCALABLE_FRAMEWORKS = ["jenkins-1.4", "diy-0.1"]  
  SCALABLE_EMBEDDED_CARTS = ["mysql-5.1", "mongodb-2.2", "postgresql-8.4", "jenkins-client-1.4"]  
  
# https://github.com/openshift/origin-server/blob/2fa96105fd5aacd90ac81c3df3fc92d7b520148d/controller/app/models/cloud_user.rb#L1-L4  
 class CloudUser < OpenShift::UserModel  
  attr_accessor :login, :uuid, :system_ssh_keys, :env_vars, :ssh_keys, :domains, :max_gears, :consumed_gears, :applications,  
                :auth_method, :save_jobs, :usage_records, :gear_usage_records, :capabilities, :parent_user_login,  
                :plan_id, :usage_account_id, :pending_plan_id, :pending_plan_uptime  
  
  
# https://github.com/openshift/origin-server/blob/2fa96105fd5aacd90ac81c3df3fc92d7b520148d/controller/app/controllers/legacy_broker_controller.rb#L16-L60  
  
  def user_info_post  
    if @cloud_user  
      user_info = @cloud_user.as_json  
      #FIXME: This is redundant, for now keeping it for backward compatibility  
      key_info = @cloud_user.get_ssh_key  
      if key_info  
        user_info["ssh_key"] = key_info['key']  
        user_info["ssh_type"] = key_info['type']  
      else  
        user_info["ssh_key"] = ""  
        user_info["ssh_type"] = ""  
      end  
          
      user_info["rhlogin"] = user_info["login"]  
      user_info.delete("login")   
      # this is to support old version of client tools  
      if @cloud_user.domains and @cloud_user.domains.length > 0  
        user_info["namespace"] = @cloud_user.domains.first.namespace  
      end  
      user_info[:rhc_domain] = Rails.configuration.openshift[:domain_suffix]  
      app_info = {}  
      unless @cloud_user.applications.nil?  
        @cloud_user.applications.each do |app|  
          app_info[app.name] = {  
            "framework" => app.framework,  
            "creation_time" => app.creation_time,  
            "uuid" => app.uuid,  
            "aliases" => app.aliases,  
            "embedded" => app.embedded  
          }  
        end  
      end  
        
      log_action(@request_id, @cloud_user.uuid, @login, "LEGACY_USER_INFO", true, "", get_extra_log_args)  
      @reply.data = {:user_info => user_info, :app_info => app_info}.to_json  
      render :json => @reply  
    else  
      log_action(@request_id, "nil", @login, "LEGACY_USER_INFO", true, "User not found", get_extra_log_args)  
      # Return a 404 to denote the user doesn't exist  
      @reply.resultIO << "User does not exist"  
      @reply.exitcode = 99  
        
      render :json => @reply, :status => :not_found  
    end  
  end  
  
  
# https://github.com/openshift/origin-server/blob/2fa96105fd5aacd90ac81c3df3fc92d7b520148d/controller/config/routes.rb#L1-7  
Rails.application.routes.draw do  
  match 'cartridge'       => 'legacy_broker#cartridge_post', :via => [:post]  
  match 'embed_cartridge' => 'legacy_broker#embed_cartridge_post', :via => [:post]  
  match 'domain'          => 'legacy_broker#domain_post', :via => [:post]  
  match 'userinfo'        => 'legacy_broker#user_info_post', :via => [:post] # HERE IS THE FLOW  
  match 'cartlist'        => 'legacy_broker#cart_list_post', :via => [:post]  
  match 'ssh_keys'        => 'legacy_broker#ssh_keys_post', :via => [:post]      
  
  
# https://github.com/openshift/rhc/blob/24935cd9dd4c8b1ff42e050c04fe525e1ba81e56/bin/rhc-chk#L280-L305  
  
class Test2_Authentication < Test::Unit::TestCase  
  include TestBase  
  #  
  # Checking Authentication  
  #  
  def test_authentication  
    assert $connectivity, error_for(:cant_connect)  
  
    data = {'rhlogin' => $rhlogin}  
    response = fetch_url_json("/broker/userinfo", data)  
    resp_json = RHC::json_decode(response.body)  
  
    case response.code.to_i  
    when 404  
      assert false, error_for(:_404, $rhlogin)       
    when 401  
      assert false, error_for(:_401, $rhlogin)       
    when 200  
      assert true  
    else  
      assert false, error_for(:_other_http, resp_json['result'])  
    end  
  
    $user_info = RHC::json_decode(resp_json['data'].to_s)  
  end  
end  
  
# https://github.com/openshift/rhc/blob/24935cd9dd4c8b1ff42e050c04fe525e1ba81e56/bin/rhc-chk#L152-L174  
  
  def fetch_url_json(uri, data)  
    json_data = RHC::generate_json(data)  
    url = URI.parse("https://#{$libra_server}#{uri}")  
    req = $http::Post.new(url.path)  
    req.set_form_data({'json_data' => json_data, 'password' => $password})  
    http = $http.new(url.host, url.port)  
    http.open_timeout = 10  
    http.use_ssl = true  
    http.verify_mode = OpenSSL::SSL::VERIFY_NONE  
  
    response = http.start {|http| http.request(req)}  
    return response  
  ensure  
    unless response.nil?  
      $debuginfo['fetches'] ||= []  
      body = RHC::json_decode(response.body)  
      body['data'] = body['data'] && body['data'] != '' ? RHC::json_decode(body['data']) : ''  
      $debuginfo['fetches'] << {url.to_s => {  
        'body' => body,  
        'header' => response.instance_variable_get(:@header)  
      }}  
    end  
  end  
  
# https://github.com/openshift/rhc/blob/24935cd9dd4c8b1ff42e050c04fe525e1ba81e56/bin/rhc-chk#L518-L525  
    if $debug  
      Tempfile.open(%w(rhc-chk. .log))do |file|  
        ObjectSpace.undefine_finalizer(file) # persist tempfile  
        file.write $debuginfo.to_yaml # HERE IS THE SINK 1  
        puts  
        puts "Debugging information dumped to #{file.path}"  
      end  
    end  
  
```  
