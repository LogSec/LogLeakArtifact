## Summary:  
Software: ovirt/ovirt_engine  
## Fix:  
Commit: https://github.com/oVirt/ovirt-engine/commit/2f9136da8b4208cc5ba5113c7f99b7c70dc7f802  
Change Size: +16 -0  
Author: Yedidyah Bar David  
Fix Pattern: Sanitization -> Redaction -> Reuse (可提炼重用模式) -> Tag/TypeBasedFiltration -> RedactionFunctionDefined  
Fix Time (of the Last Commit): 2016-08-24  
  
Fixing-commits Count: 1  
Total Change Size: +16 0  
## Sample logs: Yes  
```  
/var/log/ovirt-engine/engine.log:2016-08-24 10:10:20,764 INFO  [org.ovirt.engine.core.uutils.config.ShellLikeConfd] (ServerService Thread Pool -- 45) [] Value of property 'DWH_DB_PASSWORD' is 'zJQ11m3Cl4tJIrXJ0sdKEj'.  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> DWH_DB_PASSWORD  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（dumpConfig）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/oVirt/ovirt-dwh/blob/02711f7211a8fa8846baf16bcc93ced4a8c6880c/packaging/services/ovirt-engine-dwhd/ovirt-engine-dwhd.conf.in#L93） -> Configurations（DWH_DB_PASSWORD，finally outputed to logs）  
#### Sink 2:  
Logging call Function:  User-defined（dumpConfig）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/oVirt/ovirt-dwh/blob/02711f7211a8fa8846baf16bcc93ced4a8c6880c/packaging/services/ovirt-engine-dwhd/ovirt-engine-dwhd.conf.in#L93） -> Configurations（DWH_DB_PASSWORD，finally outputed to logs）  
Programming Language:Java  
```java  
// https://github.com/oVirt/ovirt-engine/blob/2f9136da8b4208cc5ba5113c7f99b7c70dc7f802/backend/manager/modules/uutils/src/main/java/org/ovirt/engine/core/uutils/config/ShellLikeConfd.java#L58-L140  
  
    /**  
     * Use configuration from map.  
     * @param values map.  
     */  
    protected void setConfig(Map<String, String> values) {  
        this.values = values;  
        dumpConfig(); // HERE IS THE SINK 1  
    }  
  
    /**  
     * Use configuration from files.  
     * @param defaultsPath path to file containing the defaults.  
     * @param varsPath path to file and directory of file.d.  
     */  
    protected void loadConfig(String defaultsPath, String varsPath) {  
        // This is the list of configuration files that will be loaded and  
        // merged (the initial size is 2 because usually we will have only two  
        // configuration files to merge, the defaults and the variables):  
        List<File> configFiles = new ArrayList<>(2);  
  
        if (!StringUtils.isEmpty(defaultsPath)) {  
            File defaultsFile = new File(defaultsPath);  
            configFiles.add(defaultsFile);  
        }  
  
        if (!StringUtils.isEmpty(varsPath)) {  
            File varsFile = new File(varsPath);  
            configFiles.add(varsFile);  
  
            // Locate the override values directory and add the .conf files inside  
            // to the list, sorted alphabetically:  
            File[] varsFiles = new File(varsPath + ".d").listFiles(  
                new FilenameFilter() {  
                    @Override  
                    public boolean accept(File parent, String name) {  
                        return name.endsWith(".conf");  
                    }  
                }  
            );  
            if (varsFiles != null) {  
                Arrays.sort(varsFiles, Comparator.comparing(File::getName));  
                for (File file : varsFiles) {  
                    configFiles.add(file);  
                }  
            }  
        }  
  
        // Load the configuration files in the order they are in the list:  
        for (File configFile : configFiles) {  
            try {  
                loadProperties(configFile);  
            }  
            catch (IOException exception) {  
                String message = "Can't load configuration file.";  
                log.error(message, exception);  
                throw new IllegalStateException(message, exception);  
            }  
        }  
  
        dumpConfig(); // HERE IS THE SINK 2  
    }  
  
  
    /**  
     * Dump all configuration to the log.  
     * this should probably be DEBUG, but as it will usually happen only once,  
     * during the startup, is not that a roblem to use INFO.  
     */  
    private void dumpConfig() {  
        if (log.isInfoEnabled()) {  
            Set<String> keys = values.keySet();  
            List<String> list = new ArrayList<>(keys.size());  
            List<String> sensitiveKeys = Arrays.asList(getSensitiveKeys());  
            list.addAll(keys);  
            Collections.sort(list);  
            for (String key : list) {  
                String value = "***";  
                if (!sensitiveKeys.contains(key)) {  
                    value = values.get(key);  
                }  
                log.info("Value of property '{}' is '{}'.", key, value); // HERE IS THE INNER SINK  
            }  
        }  
    }  
  
// https://github.com/oVirt/ovirt-engine/blob/2f9136da8b4208cc5ba5113c7f99b7c70dc7f802/backend/manager/modules/uutils/src/main/java/org/ovirt/engine/core/uutils/config/ShellLikeConfd.java#L499-L507  
  
    public String[] getSensitiveKeys() {  
        String sensitiveKeys = values.get(SENSITIVE_KEYS);  
        if (sensitiveKeys == null) {  
            return new String[] {};  
        }  
        else {  
            return sensitiveKeys.split(",");  
        }  
    }  
  
```  
