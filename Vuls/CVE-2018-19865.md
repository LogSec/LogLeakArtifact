## Summary:  
Software: qt  
## Fix:  
Commit: https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77  
Author: Mitch Curtis  
Fix Time (of the Last Commit): 2018-11-14  
Fix Pattern: Disable Logging in Default  
  
  
Fixing-commits Count: 3  
Total Change Size: +67 -12  
  
========  
Commit: https://github.com/qt/qtvirtualkeyboard/commit/c7a94110987672308ed04b40fd8ed207d1c8d93b  
Change Size: +15 -3  
Commit: https://github.com/qt/qtvirtualkeyboard/commit/d6ca2af52b8ee363ae02f111cbc57ebb427754d8  
Change Size: +17 -3  
Commit: https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77  
Change Size: +35 -6  
  
Review: https://codereview.qt-project.org/c/qt/qtvirtualkeyboard/+/244569  
Review: https://codereview.qt-project.org/c/qt/qtvirtualkeyboard/+/245283  
Review: https://codereview.qt-project.org/c/qt/qtvirtualkeyboard/+/245640  
## Sample logs: No  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:users' behavior data -> keystroke  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（VIRTUALKEYBOARD_DEBUG）  
Sensitiveness-Identifiable Source:  No  
#### Sink 2:  
Logging call Function:  User-defined（qWarning）  
Sensitiveness-Identifiable Source:  No  
#### Sink 3:  
Logging call Function:  User-defined（VIRTUALKEYBOARD_DEBUG）  
Sensitiveness-Identifiable Source:  No  
#### Sink 4:  
Logging call Function:  User-defined（VIRTUALKEYBOARD_DEBUG）  
Sensitiveness-Identifiable Source:  No  
#### Sink 5:  
Logging call Function:  User-defined（VIRTUALKEYBOARD_DEBUG）  
Sensitiveness-Identifiable Source:  No  
#### Sink 6:  
Logging call Function:  User-defined（qCDebug）  
Sensitiveness-Identifiable Source:  No  
#### Sink 7:  
Logging call Function:  User-defined（qCDebug）  
Sensitiveness-Identifiable Source:  No  
#### Sink 8:  
Logging call Function:  User-defined（qCDebug）  
Sensitiveness-Identifiable Source:  No  
#### Sink 9:  
Logging call Function:  User-defined（qCDebug）  
Sensitiveness-Identifiable Source:  No  
#### Sink 10:  
Logging call Function:  User-defined（qCDebug）  
Sensitiveness-Identifiable Source:  No  
#### Sink 11:  
Logging call Function:  User-defined（VIRTUALKEYBOARD_DEBUG）  
Sensitiveness-Identifiable Source:  No  
#### Sink 12:  
Logging call Function:  User-defined（VIRTUALKEYBOARD_DEBUG）  
Sensitiveness-Identifiable Source:  No  
#### Sink 13:  
Logging call Function:  User-defined（VIRTUALKEYBOARD_DEBUG）  
Sensitiveness-Identifiable Source:  No  
Programming Language:C/C++  
```C++  
// https://github.com/qt/qtvirtualkeyboard/blob/d8906c5f36540baef2886e5c6f5b7b4199525f5c/src/virtualkeyboard/inputcontext.cpp#L437-L458  
  
/*!  
    Sends a key click event with the given \a key, \a text and \a modifiers to  
    the input item that currently has focus.  
*/  
void InputContext::sendKeyClick(int key, const QString &text, int modifiers)  
{  
    Q_D(InputContext);  
    if (d->focus && d->inputContext) {  
        QKeyEvent pressEvent(QEvent::KeyPress, key, Qt::KeyboardModifiers(modifiers), text);  
        QKeyEvent releaseEvent(QEvent::KeyRelease, key, Qt::KeyboardModifiers(modifiers), text);  
        VIRTUALKEYBOARD_DEBUG() << "InputContext::sendKeyClick():" << key; // HERE IS THE SINK 1  
  
        d->stateFlags |= InputContextPrivate::KeyEventState;  
        d->inputContext->sendKeyEvent(&pressEvent);  
        d->inputContext->sendKeyEvent(&releaseEvent);  
        if (d->activeKeys.isEmpty())  
            d->stateFlags &= ~InputContextPrivate::KeyEventState;  
    } else {  
        qWarning() << "InputContext::sendKeyClick(): no focus to send key click" << key << text  
                   << "- QGuiApplication::focusWindow() is:" << QGuiApplication::focusWindow(); // HERE IS THE SINK 2   
    }  
}  
  
  
// https://github.com/qt/qtvirtualkeyboard/blob/ca5ee85100306bbfe5746d0dc56e07c534884666/src/virtualkeyboard/qvirtualkeyboardinputengine.cpp#L184-L232  
/*!  
    \qmlmethod bool InputEngine::virtualKeyPress(int key, string text, int modifiers, bool repeat)  
    Called by the keyboard layer to indicate that \a key was pressed, with  
    the given \a text and \a modifiers.  
    The \a key is set as an active key (down key). The actual key event is  
    triggered when the key is released by the virtualKeyRelease() method. The  
    key press event can be discarded by calling virtualKeyCancel().  
    The key press also initiates the key repeat timer if \a repeat is \c true.  
    Returns \c true if the key was accepted by this input engine.  
    \sa virtualKeyCancel(), virtualKeyRelease()  
*/  
/*!  
    Called by the keyboard layer to indicate that \a key was pressed, with  
    the given \a text and \a modifiers.  
    The \a key is set as an active key (down key). The actual key event is  
    triggered when the key is released by the virtualKeyRelease() method. The  
    key press event can be discarded by calling virtualKeyCancel().  
    The key press also initiates the key repeat timer if \a repeat is \c true.  
    Returns \c true if the key was accepted by this input engine.  
    \sa virtualKeyCancel(), virtualKeyRelease()  
*/  
bool QVirtualKeyboardInputEngine::virtualKeyPress(Qt::Key key, const QString &text, Qt::KeyboardModifiers modifiers, bool repeat)  
{  
    Q_D(QVirtualKeyboardInputEngine);  
    VIRTUALKEYBOARD_DEBUG() << "QVirtualKeyboardInputEngine::virtualKeyPress():" << key << text << modifiers << repeat; // HERE IS THE SINK 3  
    bool accept = false;  
    if (d->activeKey == Qt::Key_unknown || d->activeKey == key) {  
        d->activeKey = key;  
        d->activeKeyText = text;  
        d->activeKeyModifiers = modifiers;  
        if (repeat) {  
            d->repeatTimer = startTimer(600);  
        }  
        accept = true;  
        emit activeKeyChanged(d->activeKey);  
    } else {  
        qWarning("key press ignored; key is already active");  
    }  
    return accept;  
}  
  
// https://github.com/qt/qtvirtualkeyboard/blob/ca5ee85100306bbfe5746d0dc56e07c534884666/src/virtualkeyboard/qvirtualkeyboardinputengine.cpp#L265-L309  
  
/*!  
    \qmlmethod bool InputEngine::virtualKeyRelease(int key, string text, int modifiers)  
    Releases the key at \a key. The method emits a key event for the input  
    method if the event has not been generated by a repeating timer.  
    The \a text and \a modifiers are passed to the input method.  
    Returns \c true if the key was accepted by the input engine.  
*/  
/*!  
    Releases the key at \a key. The method emits a key event for the input  
    method if the event has not been generated by a repeating timer.  
    The \a text and \a modifiers are passed to the input method.  
    Returns \c true if the key was accepted by the input engine.  
*/  
bool QVirtualKeyboardInputEngine::virtualKeyRelease(Qt::Key key, const QString &text, Qt::KeyboardModifiers modifiers)  
{  
    Q_D(QVirtualKeyboardInputEngine);  
    VIRTUALKEYBOARD_DEBUG() << "QVirtualKeyboardInputEngine::virtualKeyRelease():" << key << text << modifiers; // HERE IS THE SINK 4  
    bool accept = false;  
    if (d->activeKey == key) {  
        if (!d->repeatCount) {  
            accept = d->virtualKeyClick(key, text, modifiers, false);  
        } else {  
            accept = true;  
        }  
    } else {  
        qWarning("key release ignored; key is not pressed");  
    }  
    if (d->activeKey != Qt::Key_unknown) {  
        d->previousKey = d->activeKey;  
        emit previousKeyChanged(d->previousKey);  
        d->activeKey = Qt::Key_unknown;  
        d->activeKeyText = QString();  
        d->activeKeyModifiers = Qt::KeyboardModifiers();  
        if (d->repeatTimer) {  
            killTimer(d->repeatTimer);  
            d->repeatTimer = 0;  
            d->repeatCount = 0;  
        }  
        emit activeKeyChanged(d->activeKey);  
    }  
    return accept;  
}  
  
// https://github.com/qt/qtvirtualkeyboard/blob/ca5ee85100306bbfe5746d0dc56e07c534884666/src/virtualkeyboard/qvirtualkeyboardinputengine.cpp#L311-L326  
  
/*!  
    \qmlmethod bool InputEngine::virtualKeyClick(int key, string text, int modifiers)  
    Emits a key click event for the given \a key, \a text and \a modifiers.  
    Returns \c true if the key event was accepted by the input engine.  
*/  
/*!  
    Emits a key click event for the given \a key, \a text and \a modifiers.  
    Returns \c true if the key event was accepted by the input engine.  
*/  
bool QVirtualKeyboardInputEngine::virtualKeyClick(Qt::Key key, const QString &text, Qt::KeyboardModifiers modifiers)  
{  
    Q_D(QVirtualKeyboardInputEngine);  
    VIRTUALKEYBOARD_DEBUG() << "QVirtualKeyboardInputEngine::virtualKeyClick():" << key << text << modifiers; // HERE IS THE SINK 5  
    return d->virtualKeyClick(key, text, modifiers, false);  
}  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-7ab8bbea15f72fb7f8755def651a5aa1aefa79d915efc44cd6d7911e811b5a06L622-L636  
  
void LipiInputMethod::resultsAvailable(const QVariantList &resultList)  
{  
    if (lcLipi().isDebugEnabled()) {  
        qCDebug(lcLipi) << "LipiInputMethod::resultsAvailable():";  
        for (int i = 0; i < resultList.size(); i++) {  
            QVariantMap result = resultList.at(i).toMap();  
            const QChar unicode = result[QLatin1String("unicode")].toChar();  
            const double confidence = result[QLatin1String("confidence")].toDouble();  
            qCDebug(lcLipi) << QStringLiteral("%1: %2 (%3)").arg(i + 1)  
                               .arg(unicode).arg(confidence).toUtf8().constData(); // HERE IS THE SINK 6  
        }  
    }  
    Q_D(LipiInputMethod);  
    d->resultsAvailable(resultList);  
}  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-efe9e695f0006369845b61460ce628f00b74caacd6d1578ef45b64fe89292960L884-L893  
  
    void updatePreeditTextCursor(int cursorPosition)  
    {  
        Q_Q(MyScriptInputMethod);  
        QVirtualKeyboardInputContext *ic = q->inputContext();  
        if (!ic)  
            return;  
  
        qCDebug(qlcVKMyScript) << Q_FUNC_INFO;  
        qCDebug(qlcVKMyScript) << "preeditText:" << ic->preeditText(); // HERE IS THE SINK 7  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-efe9e695f0006369845b61460ce628f00b74caacd6d1578ef45b64fe89292960L1302-L1303  
    float score = voim_getItemCandidateScore(engine, result, itemIndex, candidateIndex);  
    qCDebug(qlcVKMyScript) << "      - candidate #" << candidateIndex << " of " << candidateCount << " :" << temp << "(" << score << ")"; // HERE IS THE SINK 8  
  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-e7d8f2e75f6036df1b82f25293372765efa9a5a58b0a8eaa8db1b8d0bbaa0fe8L2128-L2154  
void T9WriteInputMethod::resultsAvailable(const QVariantList &resultList)  
{  
    if (lcT9Write().isDebugEnabled()) {  
        qCDebug(lcT9Write) << "T9WriteInputMethod::resultsAvailable():";  
        for (int i = 0; i < resultList.size(); i++) {  
            QVariantMap result = resultList.at(i).toMap();  
            QString resultPrint = QStringLiteral("%1: ").arg(i + 1);  
            QString resultChars = result.value(QLatin1String("chars")).toString();  
            if (!resultChars.isEmpty())  
                resultPrint.append(resultChars);  
            if (result.contains(QLatin1String("gesture"))) {  
                if (!resultChars.isEmpty())  
                    resultPrint.append(QLatin1String(", "));  
                QString gesture = result[QLatin1String("gesture")].toString();  
                resultPrint.append(QLatin1String("gesture ="));  
                for (const QChar &chr : gesture) {  
                    resultPrint.append(QString::fromLatin1(" 0x%1").arg(chr.unicode(), 0, 16));  
                }  
            }  
            qCDebug(lcT9Write) << resultPrint.toUtf8().constData(); // HERE IS THE SINK 9  
        }  
    }  
    Q_D(T9WriteInputMethod);  
    QMutexLocker resultListGuard(&d->resultListLock);  
    d->resultList = resultList;  
    emit resultListChanged();  
}  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-72741fa1f91dbc7c4990aa4a0f45accdd73a99ea69c7e3e85f0d05b46e3cd88aL176  
qCDebug(lcT9Write) << "T9WriteRecognitionTask():" << "boostLevel:" << boostLevel << "stringStart:" << stringStart; // HERE IS THE SINK 10  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-6b919c4fc05a40f3003a879f38025c90f15f9926cc4920fa12271af3cb46c196L278-L281  
  
void QVirtualKeyboardInputContext::commit(const QString &text, int replaceFrom, int replaceLength)  
{  
    Q_D(QVirtualKeyboardInputContext);  
    VIRTUALKEYBOARD_DEBUG() << "QVirtualKeyboardInputContext::commit():" << text << replaceFrom << replaceLength; // HERE IS THE SINK 11  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-3cbe13e86a28cade1c49b260404385f935ced89a410af89c1f83c606dd2ed45fL268-L270  
  
void QVirtualKeyboardInputContextPrivate::sendPreedit(const QString &text, const QList<QInputMethodEvent::Attribute> &attributes, int replaceFrom, int replaceLength)  
{  
    VIRTUALKEYBOARD_DEBUG() << "QVirtualKeyboardInputContextPrivate::sendPreedit():" << text << replaceFrom << replaceLength; // HERE IS THE SINK 12  
  
// https://github.com/qt/qtvirtualkeyboard/commit/5d2d0564a36f99224dc53ad477416097516c6b77#diff-3cbe13e86a28cade1c49b260404385f935ced89a410af89c1f83c606dd2ed45fL292  
  
VIRTUALKEYBOARD_DEBUG() << "QVirtualKeyboardInputContextPrivate::sendPreedit(shadow):" << text << replaceFrom << replaceLength; // HERE IS THE SINK 13  
  
```  
