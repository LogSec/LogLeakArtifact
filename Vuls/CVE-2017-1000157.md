## Summary:  
Software: mahara  
## Fix:  
Commit: https://git.mahara.org/mahara/mahara/-/commit/433ab8e6d309a2174c5b523f3a6c354f14f61587  
Change Size: +29 -1  
Author: Robert Lyon  
Fix Time (of the Last Commit): 2017-05-23  
Fix Pattern: Sanitization -> Redaction  
  
Fixing-commits Count: 1  
Total Change Size: +29 -1  
## Sample logs: No  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> passwords  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（insert_record，定义在lib/dml.php）  
Sensitiveness-Identifiable Source:  Same Modules & Cross Files（https://git.mahara.org/mahara/mahara/-/blob/07734f78f98b6e415e3d96f70cc01adbf0d09ff3/htdocs/lib/user.php#L2509，https://git.mahara.org/mahara/mahara/-/blob/433ab8e6d309a2174c5b523f3a6c354f14f61587/htdocs/auth/user.php#L43） -> Method Names（reset_password）|String Literals（password）  
Programming Language:PHP  
```PHP  
  
// https://git.mahara.org/mahara/mahara/-/blob/433ab8e6d309a2174c5b523f3a6c354f14f61587/htdocs/lib/mahara.php#L1843-1944  
  
/**  
 * Fires an event which can be handled by different parts of the system  
 */  
function handle_event($event, $data) {  
    global $USER;  
    static $event_types = array(), $coreevents_cache = array(), $eventsubs_cache = array();  
  
    if (empty($event_types)) {  
        $event_types = array_fill_keys(get_column('event_type', 'name'), true);  
    }  
  
    $e = $event_types[$event];  
  
    if (is_null($e)) {  
        throw new SystemException("Invalid event");  
    }  
  
    if ($data instanceof ArtefactType) {  
        // leave $data alone, but convert for the event log  
        $logdata = $data->to_stdclass();  
    }  
    else if ($data instanceof BlockInstance) {  
        // leave $data alone, but convert for the event log  
        $logdata = array(  
            'id' => $data->get('id'),  
            'blocktype' => $data->get('blocktype'),  
        );  
    }  
    else if (is_object($data)) {  
        if (isset($data->password)) {  
            unset($data->password);  
        }  
        $data = (array)$data;  
    }  
    else if (is_numeric($data)) {  
        $data = array('id' => $data);  
    }  
  
    $parentuser = $USER->get('parentuser');  
    $eventloglevel = get_config('eventloglevel');  
    if ($eventloglevel === 'all'  
            or ($parentuser and $eventloglevel === 'masq')) {  
        $logentry = (object) array(  
            'usr'      => $USER->get('id'),  
            'realusr'  => $parentuser ? $parentuser->id : $USER->get('id'),  
            'event'    => $event,  
            'data'     => json_encode(isset($logdata) ? $logdata : $data),  
            'time'     => db_format_timestamp(time()),  
        );  
        insert_record('event_log', $logentry); // HERE IS THE SINK 1  
    }  
  
    if (empty($coreevents_cache)) {  
        $rs = get_recordset('event_subscription');  
        foreach($rs as $record) {  
            $coreevents_cache[$record['event']][] = $record['callfunction'];  
        }  
        $rs->close();  
    }  
  
    $coreevents = isset($coreevents_cache[$event]) ? $coreevents_cache[$event] : array();  
  
    if (!empty($coreevents)) {  
        require_once('activity.php'); // core events can generate activity.  
        foreach ($coreevents as $ce) {  
            if (function_exists($ce)) {  
                call_user_func($ce, $data);  
            }  
            else {  
                log_warn("Event $event caused a problem with a core subscription "  
                . " $ce, which wasn't callable.  Continuing with event handlers");  
            }  
        }  
    }  
  
    $plugintypes = plugin_types_installed();  
    foreach ($plugintypes as $name) {  
        $cache_key = "{$event}__{$name}";  
        if (!isset($eventsubs_cache[$cache_key])) {  
            $eventsubs_cache[$cache_key] = get_records_array($name . '_event_subscription', 'event', $event);  
        }  
        if ($eventsubs_cache[$cache_key]) {  
            $pluginsinstalled = plugins_installed($name);  
            foreach ($eventsubs_cache[$cache_key] as $sub) {  
                if (!isset($pluginsinstalled[$sub->plugin])) {  
                    continue;  
                }  
                safe_require($name, $sub->plugin);  
                $classname = 'Plugin' . ucfirst($name) . ucfirst($sub->plugin);  
                try {  
                    if (method_exists($classname, $sub->callfunction)) {  
                        call_static_method($classname, $sub->callfunction, $event, $data);  
                    }  
                }  
                catch (Exception $e) {  
                    log_warn("Event $event caused an exception from plugin $classname "  
                             . "with function $sub->callfunction. Continuing with event handlers");  
                }  
            }  
        }  
    }  
}  
  
  
```  
