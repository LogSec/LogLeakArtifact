## Summary:  
Software: jboss  
## Fix:  
Commit: https://github.com/wildfly-security/jboss-negotiation/pull/21/commits/0dc9d191b6eb1d13b8f0189c5b02ba6576f4722e  
Fix Time (of the Last Commit): 2015-03-26  
Author: Spolti  
Fix Pattern: Sanitization -> Redaction -> Enhancement (Corrective Change) -> Keyword/RegexBasedFiltration -> NoRedactionFunctionDefined  
  
  
Fixing-commits Count: 2  
Total Change Size: +12 -68  
  
========  
Commit: https://github.com/wildfly-security/jboss-negotiation/pull/21/commits/347d35e7b4cd72f1148f27d4b263d269a43f108f  
Time: 2015-03-20  
Author: Spolti  
Commit: https://github.com/wildfly-security/jboss-negotiation/pull/21/commits/0dc9d191b6eb1d13b8f0189c5b02ba6576f4722e  
Time: 2015-03-26  
Author: Spolti  
  
## Sample logs: Yes  
```  
2015-03-19 19:33:28,569 TRACE [org.jboss.security.auth.spi.AbstractServerLoginModule] (http-localhost/127.0.0.1:8080-1) Logging into LDAP server, env={baseFilter=(userPrincipalName={0}), java.naming.security.credentials=***, jboss.security.security_domain=SPNEGO, java.naming.ldap.attributes.binary=objectSid, password-stacking=useFirstPass, recurseRoles=false, java.naming.security.authentication=simple, baseCtxDN=DC=example,DC=com, roleAttributeIsDN=true, rolesCtxDN=DC=example,DC=com, java.naming.security.principal=bindUser, allowEmptyPassword=true, java.naming.factory.initial=com.sun.jndi.ldap.LdapCtxFactory, java.naming.provider.url=ldap://127.0.0.1:389, roleNameAttributeID=cn, roleAttributeID=memberOf, bindDN=bindUser, bindCredential=password}  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> LDAP bind credential password  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（traceLdapEnv）  
Sensitiveness-Identifiable Source:  Same Methods & Cross Statements（https://github.com/spolti/jboss-negotiation/blob/0dc9d191b6eb1d13b8f0189c5b02ba6576f4722e/jboss-negotiation-extras/src/main/java/org/jboss/security/negotiation/AdvancedLdapLoginModule.java#L475） -> Variable Names（credential）|String Literals（java.naming.security.credentials，finally outputed to logs）  
Programming Language:Java  
```java  
// https://github.com/spolti/jboss-negotiation/blob/0dc9d191b6eb1d13b8f0189c5b02ba6576f4722e/jboss-negotiation-extras/src/main/java/org/jboss/security/negotiation/AdvancedLdapLoginModule.java#L424-L478  
  
   private Properties constructLdapContextEnvironment(String namingProviderURL, String principalDN, Object credential, String authentication)   
   {  
       Properties env = createBaseProperties();  
  
       // Set defaults for key values if they are missing  
       String factoryName = env.getProperty(Context.INITIAL_CONTEXT_FACTORY);  
       if (factoryName == null)  
       {  
          factoryName = DEFAULT_LDAP_CTX_FACTORY;  
          env.setProperty(Context.INITIAL_CONTEXT_FACTORY, factoryName);  
       }  
  
       // If this method is called with an authentication type then use that.  
       if (authentication != null && authentication.length() > 0)  
       {  
          env.setProperty(Context.SECURITY_AUTHENTICATION, authentication);  
       }  
       else  
       {  
          String authType = env.getProperty(Context.SECURITY_AUTHENTICATION);  
          if (authType == null)  
             env.setProperty(Context.SECURITY_AUTHENTICATION, AUTH_TYPE_SIMPLE);  
       }  
       String providerURL = null;  
       if (namingProviderURL != null)  
       {  
          providerURL = namingProviderURL;  
       }  
       else  
       {  
          providerURL = (String) options.get(Context.PROVIDER_URL);  
       }  
       String protocol = env.getProperty(Context.SECURITY_PROTOCOL);  
       if (providerURL == null)  
       {  
          if (PROTOCOL_SSL.equals(protocol))  
          {  
             providerURL = DEFAULT_SSL_URL;  
          }  
          else  
          {  
             providerURL = DEFAULT_URL;  
          }  
       }  
       env.setProperty(Context.PROVIDER_URL, providerURL);  
  
       // Assume the caller of this method has checked the requirements for the principal and  
       // credentials.  
       if (principalDN != null)  
          env.setProperty(Context.SECURITY_PRINCIPAL, principalDN);  
       if (credential != null)  
          env.put(Context.SECURITY_CREDENTIALS, credential);  
       traceLdapEnv(env); // HERE IS THE SINK 1  
       return env;  
   }  
  
// https://github.com/spolti/jboss-negotiation/blob/0dc9d191b6eb1d13b8f0189c5b02ba6576f4722e/jboss-negotiation-extras/src/main/java/org/jboss/security/negotiation/AdvancedLdapLoginModule.java#L903-L922  
   protected void traceLdapEnv(Properties env)  
   {  
      if (trace)  
      {  
         Properties tmp = new Properties();  
         tmp.putAll(env);  
         String credentials = tmp.getProperty(Context.SECURITY_CREDENTIALS);  
         String bindCredential = tmp.getProperty(BIND_CREDENTIAL);  
           
         if (credentials != null && credentials.length() > 0) {  
        	 tmp.setProperty(Context.SECURITY_CREDENTIALS, "***");  
         }  
              
         if (bindCredential != null && bindCredential.length() > 0) {  
        	 tmp.setProperty(BIND_CREDENTIAL, "***");  
         }  
           
         log.trace("Logging into LDAP server, env=" + tmp.toString()); // HERE IS THE INNER SINK  
      }  
   }  
  
```  
