## Summary:  
Software: misp  
## Fix:  
Commit: https://github.com/MISP/MISP/commit/7d5890b2fc63285f010d5845913894dd71cf232c  
Change Size: +1 -1  
Author: Andras Iklody  
Fix Time (of the Last Commit): 2017-11-24  
Fix Pattern: Sanitization -> Filtration  
  
Fixing-commits Count: 1  
Total Change Size: +1 -1  
## Sample logs: No  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> a hashed password  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（UsersController.__extralog）  
Sensitiveness-Identifiable Source:  Same Methods & Cross Statements（https://github.com/MISP/MISP/blob/7d5890b2fc63285f010d5845913894dd71cf232c/app/Controller/UsersController.php#L639）-> String Literals(password)  
Programming Language:PHP  
```PHP  
  
// https://github.com/MISP/MISP/blob/7d5890b2fc63285f010d5845913894dd71cf232c/app/Controller/UsersController.php#L642-L654  
  
					// compare  
					$fieldsResultStr = '';  
					$c = 0;  
					foreach ($fields as $field) {  
						if (isset($fieldsOldValues[$c]) && $fieldsOldValues[$c] != $fieldsNewValues[$c]) {  
							if ($field != 'confirm_password' && $field != 'enable_password') {  
								$fieldsResultStr = $fieldsResultStr . ', ' . $field . ' (' . $fieldsOldValues[$c] . ') => (' . $fieldsNewValues[$c] . ')';  
							}  
						}  
						$c++;  
					}  
					$fieldsResultStr = substr($fieldsResultStr, 2);  
					$this->__extralog("edit", "user", $fieldsResultStr);	// TODO Audit, check: modify User // HERE IS THE SINK 1  
  
  
# https://github.com/MISP/MISP/blob/7d5890b2fc63285f010d5845913894dd71cf232c/app/Controller/UsersController.php#L1065-L1100  
  
	private function __extralog($action = null, $description = null, $fieldsResult = null) {	// TODO move audit to AuditsController?  
		// new data  
		$model = 'User';  
		$modelId = $this->Auth->user('id');  
		if ($action == 'login') {  
			$description = "User (" . $this->Auth->user('id') . "): " . $this->data['User']['email'];  
		} else if ($action == 'logout') {  
			$description = "User (" . $this->Auth->user('id') . "): " . $this->Auth->user('email');  
		} else if ($action == 'edit') {  
			$description = "User (" . $this->User->id . "): " . $this->data['User']['email'];  
		} else if ($action == 'change_pw') {  
			$description = "User (" . $this->User->id . "): " . $this->data['User']['email'];  
			$fieldsResult = "Password changed.";  
		}  
  
		// query  
		$this->Log = ClassRegistry::init('Log');  
		$this->Log->create();  
		$this->Log->save(array(  
			'org' => $this->Auth->user('Organisation')['name'],  
			'model' => $model,  
			'model_id' => $modelId,  
			'email' => $this->Auth->user('email'),  
			'action' => $action,  
			'title' => $description,  
			'change' => isset($fieldsResult) ? $fieldsResult : ''));  
  
		// write to syslogd as well  
		App::import('Lib', 'SysLog.SysLog');  
		$syslog = new SysLog();  
		if (isset($fieldsResult) && $fieldsResult) {  
			$syslog->write('notice', $description . ' -- ' . $action . ' -- ' . $fieldsResult);  
		} else {  
			$syslog->write('notice', $description . ' -- ' . $action);  
		}  
	}  
  
  
  
```  
