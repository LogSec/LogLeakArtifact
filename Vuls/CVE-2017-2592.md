## Summary:  
Software: openstack/oslo.middleware  
## Fix:  
Commit: https://github.com/openstack/oslo.middleware/commit/df5c11ddcc06cd0b4f1ced99d7bdc1213e5eb646  
Change Size: +30 -3  
Fix Time (of the Last Commit): 2017-01-27  
Author: Jamie Lennox  
Fix Pattern: Sanitization -> Redaction -> Enhancement (Adaptive Change) -> Keyword/RegexBasedFiltration -> NoRedactionFunctionDefined  
  
Fixing-commits Count: 1  
Total Change Size: +30 -3  
## Sample logs: Yes  
```  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors [-] An error occurred during processing the request: GET /v2.0/ports.json?device_id=xxxxx HTTP/1.0  
Accept: application/json  
Accept-Encoding: gzip, deflate  
Connection: close  
Content-Type: text/plain  
Host: network.test.com:8020  
User-Agent: python-neutronclient  
X-Auth-Token: gAAAAABX6NfMz4Lj4sYIDHu0eXr9oxymDrJTDOOrKztp0NElSiZcs9Umr-v8P-s8VP_lz_aVKPobfoj1ROP9X9amp8ACqwa4FNRvFX5IatzwmjAKR42AZZnuD4jxoJoC05iT-UKIY81gqHsOY8v7DbqTLSE2eOFwrFKZIMQBUDlDaeqwpce0LDp-dZrM2JIta9tOz99aOH5CShyu-ihMy3F87CN3cMdK5qHIr7oM1UiXc97zgzbDOTA  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors Traceback (most recent call last):  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/oslo_middleware/catch_errors.py", line 38, in __call__  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors response = req.get_response(self.application)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/webob/request.py", line 1296, in send  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors application, catch_exc_info=False)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/webob/request.py", line 1260, in call_application  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors app_iter = application(self.environ, start_response)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/webob/dec.py", line 130, in __call__  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors resp = self.call_func(req, *args, **self.kwargs)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/webob/dec.py", line 195, in call_func  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors return self.func(req, *args, **kwargs)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py", line 320, in __call__  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors response = self.process_request(req)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py", line 552, in process_request  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors resp = super(AuthProtocol, self).process_request(request)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py", line 348, in process_request  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors data, user_auth_ref = self._do_fetch_token(request.user_token)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py", line 388, in _do_fetch_token  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors data = self.fetch_token(token)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py", line 670, in fetch_token  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors self._revocations.check(token_hashes)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/_revocations.py", line 104, in check  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors if self._any_revoked(token_ids):  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/_revocations.py", line 99, in _any_revoked  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors if self._is_revoked(token_id):  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/_revocations.py", line 90, in _is_revoked  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors revoked_tokens = self._list.get('revoked', None)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/_revocations.py", line 74, in _list  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors self._list = self._fetch()  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/_revocations.py", line 61, in _fetch  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors return self._cms_verify(revocation_list_data)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py", line 771, in _cms_verify  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors self._fetch_signing_cert()  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/__init__.py", line 786, in _fetch_signing_cert  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors self._identity_server.fetch_signing_cert())  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/_signing_dir.py", line 54, in write_file  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors self._verify_signing_dir()  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib/python2.7/site-packages/keystonemiddleware/auth_token/_signing_dir.py", line 90, in _verify_signing_dir  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors os.makedirs(self._directory_name, stat.S_IRWXU)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors File "/usr/lib64/python2.7/os.py", line 157, in makedirs  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors mkdir(name, mode)  
2016-09-26 05:29:36.804 28288 ERROR oslo_middleware.catch_errors OSError: [Errno 2] No such file or directory: '/tmp/keystone-signing-EVEBkJ'  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> sensitive information, keystone tokens  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（CatchErrors）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/openstack/neutron/blob/1ad9ca56b07ffdc9f7e0bc6a62af61961b9128eb/doc/source/contributor/internals/network_ip_availability.rst） -> Documentations  
Programming Language:Python  
```python  
# https://github.com/openstack/oslo.middleware/commit/df5c11ddcc06cd0b4f1ced99d7bdc1213e5eb646  
  
  
_TOKEN_RE = re.compile('^(X-\w+-Token):.*$', flags=re.MULTILINE)  
  
  
class CatchErrors(base.ConfigurableMiddleware):  
    """Middleware that provides high-level error handling.  
    It catches all exceptions from subsequent applications in WSGI pipeline  
    to hide internal errors from API response.  
    """  
  
    @webob.dec.wsgify  
    def __call__(self, req): # HERE IS THE SINK 1  
        try:  
            response = req.get_response(self.application)  
        except Exception:  
            req_str = _TOKEN_RE.sub(r'\1: *****', req.as_text())  
            LOG.exception(_LE('An error occurred during '  
                              'processing the request: %s'), req_str) # HERE IS THE INNER SINK  
            response = webob.exc.HTTPInternalServerError()  
        return response  
```  
