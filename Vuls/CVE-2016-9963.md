## Summary:  
Software: exim  
## Fix:  
Commit: https://github.com/Exim/exim/pull/51/commits/31c02defdc5118834e801d4fe8f11c1d9b5ebadf  
Change Size: +354 -1  
Author: Jeremy Harris  
Fix Time (of the Last Commit): 2016-12-20  
Fix Pattern: Sanitization -> Redaction  
  
Fixing-commits Count: 1  
Total Change Size: +354 -1  
## Sample logs: Yes  
```  
2016-12-17 09:44:33 10HmaX-0005vi-00 ** baduser@test.ex R=client T=send_to_server H=ip4.ip4.ip4.ip4 [ip4.ip4.ip4.ip4]: PRDR error after -----BEGIN RSA PRIVATE KEY-----\nMIICXQIBAAKBgQDXRFf+VhT+lCgFhhSkinZKcFNeRzjYdW8vT29Rbb3NadvTFwAd\n+cVLPFwZL8H5tUD/7JbUPqNTCPxmpgIL+V5T4tEZMorHatvvUM2qfcpQ45IfsZ+Y\ndhbIiAslHCpy4xNxIR3zylgqRUF4+Dtsaqy3a5LhwMiKCLrnzhXk1F1hxwIDAQAB\nAoGAZPokJKQQmRK6a0zn5f8lWemy0airG66KhzDF0Pafb/nWKgDCB02gpJgdw5rJ\nbO7/HI3IeqsfRdYTP7tjfmZtPiPo1mnF7D1rSRspZjOF2yXY/ky7t7c5xChRcSxf\n+69CknwjrfteY9Aj0j6o7N+2w2uvHO+AAq8BHDgXKmPo0SECQQDzQ/glyhNH9tlO\nx+3TTMwwyZUf2mYYosN3Q9NIl3Umz/3+13K5b6Ed6fZvS/XwU55Qf5IBUVj2Fujk\nRv2lbGPpAkEA4okpnzYz5nm1X5WjpJPQPyo8nGEU1A5QfoDbkAvWYvVoYrpWPOx5\nHFpOAHkvSk1Y1vhCUa+zHwiQRBC8OMp6LwJBAOAUK/AjQ792UpWO9DM++pe2F/dP\nZdwrkYG6qFSlrvQhgwXLz5GgkfjMGoRKpDDL1XixCfzMwfVtBPnBqsNGJIECQGYX\nSIGu7L7edMXJ60C9OKluwHf9LGTQuqf4LHsDSq+4Rz3PGhREwePsMqD1/EDxEKt4\noHKtyvyeYF28aQbzARMCQQCRtJlR6vlKhxYL8+xoPrCu3MijKgVruRUcNstXkDZK\nfKQax6vhiMq+0qIiEwLA1wavyLVKZ7Mfag+/4NTcDUVC\n-----END RSA PRIVATE KEY-----\n: 550 PRDR R=<baduser@test.ex> refusal  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> private DKIM signing key  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（write_logs）  
Sensitiveness-Identifiable Source:  Same Modules & Cross Files（https://github.com/Exim/exim/blob/31c02defdc5118834e801d4fe8f11c1d9b5ebadf/src/src/dkim.c#L514） -> Variable Names(dkim_private_key_expanded)  
Programming Language:C/C++  
```C++  
// https://github.com/Exim/exim/blob/31c02defdc5118834e801d4fe8f11c1d9b5ebadf/src/src/transports/smtp.c#L2413-L2423  
  
        if (!smtp_read_response(&inblock, buffer, sizeof(buffer), '2',  
            ob->final_timeout))  
          {  
          if (errno != 0 || buffer[0] == 0) goto RESPONSE_FAILED;  
          addr->message = string_sprintf(  
#ifndef DISABLE_PRDR  
	    "%s error after %s: %s", prdr_active ? "PRDR":"LMTP",   
#else  
	    "LMTP error after %s: %s",  
#endif  
            data_command, string_printing(buffer));  
  
// https://github.com/Exim/exim/blob/31c02defdc5118834e801d4fe8f11c1d9b5ebadf/src/src/transports/smtp.c#L3557-L3565  
  
      /* If the result is not OK, there was a non-message-specific problem.  
      If the result is DEFER, we need to write to the logs saying what happened  
      for this particular host, except in the case of authentication and TLS  
      failures, where the log has already been written. If all hosts defer a  
      general message is written at the end. */  
  
      if (rc == DEFER && first_addr->basic_errno != ERRNO_AUTHFAIL &&  
                         first_addr->basic_errno != ERRNO_TLSFAILURE)  
        write_logs(first_addr, host); // HERE IS THE SINK 1  
  
  
// https://github.com/Exim/exim/blob/31c02defdc5118834e801d4fe8f11c1d9b5ebadf/src/src/transports/smtp.c#L618-L649  
  
/* This writes to the main log and to the message log.  
Arguments:  
  addr     the address item containing error information  
  host     the current host  
Returns:   nothing  
*/  
  
static void  
write_logs(address_item *addr, host_item *host)  
{  
uschar * message = string_sprintf("H=%s [%s]", host->name, host->address);  
  
if (addr->message)  
  {  
  message = string_sprintf("%s: %s", message, addr->message);  
  if (addr->basic_errno > 0)  
    message = string_sprintf("%s: %s", message, strerror(addr->basic_errno));  
  log_write(0, LOG_MAIN, "%s", message);  
  deliver_msglog("%s %s\n", tod_stamp(tod_log), message);  
  }  
else  
  {  
  if (log_extra_selector & LX_outgoing_port)  
    message = string_sprintf("%s:%d", message,  
		host->port == PORT_NONE ? 25 : host->port);  
  log_write(0, LOG_MAIN, "%s %s", message, strerror(addr->basic_errno));  
  deliver_msglog("%s %s %s\n", tod_stamp(tod_log), message,  
		strerror(addr->basic_errno));  
  }  
}  
  
```  
