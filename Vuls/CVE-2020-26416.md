## Summary:  
Software: gitlab  
## Fix:  
Commit: https://gitlab.com/gitlab-org/gitlab/-/commit/39649a20fc4e4c0995d5d6988b0415cff80f52fa  
Change Size: +7 -2  
Author: GitLab Release Tools Bot  
Fix Time (of the Last Commit): 2020-12-05  
Fix Pattern: Remove -> Logging Variable  
  
Fixing-commits Count: 1  
Total Change Size: +7 -2  
## Sample logs: No  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:users' behavior data -> search terms  
### Sink labels:  
#### Sink 1:  
Logging call Function:  Third-party Libaries（append_info_to_payload）  
Sensitiveness-Identifiable Source:  Cross Projects|Cross-Libraries（https://gitlab.com/gitlab-org/gitlab/-/blob/f88bb2986c969347abfe2cb8a97b4b0ee16f7af2/app/controllers/search_controller.rb#L131） -> String Literals（search）  
Programming Language:Ruby  
```Ruby  
  
# https://gitlab.com/gitlab-org/gitlab/-/blob/f88bb2986c969347abfe2cb8a97b4b0ee16f7af2/app/controllers/search_controller.rb#L124-133  
  def append_info_to_payload(payload)  
    super  
  
    # Merging to :metadata will ensure these are logged as top level keys  
    payload[:metadata] ||= {}  
    payload[:metadata]['meta.search.group_id'] = params[:group_id]  
    payload[:metadata]['meta.search.project_id'] = params[:project_id]  
    payload[:metadata]['meta.search.search'] = params[:search]  
    payload[:metadata]['meta.search.scope'] = params[:scope]  
  end  
  
  
  
# https://github.com/rails/rails/blob/fbe2433be6e052a1acac63c7faf287c52ed3c5ba/actionpack/lib/action_controller/metal/instrumentation.rb#L87-L91  
  
    # Every time after an action is processed, this method is invoked  
    # with the payload, so you can add more information.  
    def append_info_to_payload(payload) # :doc:  
      payload[:view_runtime] = view_runtime  
    end  
  
# https://github.com/rails/rails/blob/e56a5146cf176ed752008dbbeb2cba7d43d9b333/actionpack/lib/action_controller/metal/instrumentation.rb#L19-L44  
    def process_action(*)  
      raw_payload = {  
        controller: self.class.name,  
        action: action_name,  
        request: request,  
        params: request.filtered_parameters,  
        headers: request.headers,  
        format: request.format.ref,  
        method: request.request_method,  
        path: request.fullpath  
      }  
  
      ActiveSupport::Notifications.instrument("start_processing.action_controller", raw_payload)  
  
      ActiveSupport::Notifications.instrument("process_action.action_controller", raw_payload) do |payload|  
        result = super  
        payload[:response] = response  
        payload[:status]   = response.status  
        result  
      rescue => error  
        payload[:status] = ActionDispatch::ExceptionWrapper.status_code_for_exception(error.class.name)  
        raise  
      ensure  
        append_info_to_payload(payload) # HERE IS THE FLOW  
      end  
    end  
  
# https://github.com/rails/rails/blob/e56a5146cf176ed752008dbbeb2cba7d43d9b333/actionpack/lib/action_controller/log_subscriber.rb#L20-L38  
    def process_action(event)  
      info do # HERE IS THE SINK 1  
        payload = event.payload  
        additions = ActionController::Base.log_process_action(payload)  
        status = payload[:status]  
  
        if status.nil? && (exception_class_name = payload[:exception]&.first)  
          status = ActionDispatch::ExceptionWrapper.status_code_for_exception(exception_class_name)  
        end  
  
        additions << "Allocations: #{event.allocations}"  
  
        message = +"Completed #{status} #{Rack::Utils::HTTP_STATUS_CODES[status]} in #{event.duration.round}ms"  
        message << " (#{additions.join(" | ")})"  
        message << "\n\n" if defined?(Rails.env) && Rails.env.development?  
  
        message  
      end  
    end  
  
```  
