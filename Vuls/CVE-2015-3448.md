## Summary:  
Software: rest-client  
## Fix:  
Commit: https://github.com/xaviershay/rest-client/commit/60ae4a5373e574bdeacd7b526c72f4e7d0ca858f  
Author: Xavier Shay  
Fix Time (of the Last Commit): 2015-01-28  
Fix Pattern: Sanitization -> Redaction -> Introduction -> KeywordBasedFiltration -> NoRedactionFunctionDefined  
  
Fixing-commits Count: 1  
Total Change Size: +24 -1  
  
========  
PR: https://github.com/rest-client/rest-client/pull/352  
  
Commit: https://github.com/xaviershay/rest-client/commit/60ae4a5373e574bdeacd7b526c72f4e7d0ca858f  
Change Size: +24 -1  
Author: Xavier Shay  
Time: 2015-01-28  
题  
## Sample logs: No  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> usernames and passwords  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（log_request）  
Sensitiveness-Identifiable Source:  跨方法-同文件（https://github.com/xaviershay/rest-client/blob/08480eb86aef1e6185ccf12a530611cefe720f4b/lib/restclient/request.rb#L299） -> Variable Names(password)  
Programming Language:Ruby  
```Ruby  
# https://github.com/xaviershay/rest-client/blob/08480eb86aef1e6185ccf12a530611cefe720f4b/lib/restclient/request.rb#L535-L543  
  
    def log_request  
      return unless RestClient.log  
  
      out = []  
      out << "RestClient.#{method} #{url.inspect}"  
      out << payload.short_inspect if payload  
      out << processed_headers.to_a.sort.map { |(k, v)| [k.inspect, v.inspect].join("=>") }.join(", ")  
      RestClient.log << out.join(', ') + "\n" # HERE IS THE INNER SINK  
    end  
  
  
# https://github.com/xaviershay/rest-client/blob/08480eb86aef1e6185ccf12a530611cefe720f4b/lib/restclient/request.rb#L366-L466  
  
    def transmit uri, req, payload, & block  
      setup_credentials req  
  
      net = net_http_class.new(uri.hostname, uri.port)  
      net.use_ssl = uri.is_a?(URI::HTTPS)  
      net.ssl_version = ssl_version if ssl_version  
      net.ciphers = ssl_ciphers if ssl_ciphers  
  
      net.verify_mode = verify_ssl  
  
      net.cert = ssl_client_cert if ssl_client_cert  
      net.key = ssl_client_key if ssl_client_key  
      net.ca_file = ssl_ca_file if ssl_ca_file  
      net.ca_path = ssl_ca_path if ssl_ca_path  
      net.cert_store = ssl_cert_store if ssl_cert_store  
  
      # We no longer rely on net.verify_callback for the main SSL verification  
      # because it's not well supported on all platforms (see comments below).  
      # But do allow users to set one if they want.  
      if ssl_verify_callback  
        net.verify_callback = ssl_verify_callback  
  
        # Hilariously, jruby only calls the callback when cert_store is set to  
        # something, so make sure to set one.  
        # https://github.com/jruby/jruby/issues/597  
        if RestClient::Platform.jruby?  
          net.cert_store ||= OpenSSL::X509::Store.new  
        end  
  
        if ssl_verify_callback_warnings != false  
          if print_verify_callback_warnings  
            warn('pass :ssl_verify_callback_warnings => false to silence this')  
          end  
        end  
      end  
  
      if OpenSSL::SSL::VERIFY_PEER == OpenSSL::SSL::VERIFY_NONE  
        warn('WARNING: OpenSSL::SSL::VERIFY_PEER == OpenSSL::SSL::VERIFY_NONE')  
        warn('This dangerous monkey patch leaves you open to MITM attacks!')  
        warn('Try passing :verify_ssl => false instead.')  
      end  
  
      if defined? @timeout  
        if @timeout == -1  
          warn 'To disable read timeouts, please set timeout to nil instead of -1'  
          @timeout = nil  
        end  
        net.read_timeout = @timeout  
      end  
      if defined? @open_timeout  
        if @open_timeout == -1  
          warn 'To disable open timeouts, please set open_timeout to nil instead of -1'  
          @open_timeout = nil  
        end  
        net.open_timeout = @open_timeout  
      end  
  
      RestClient.before_execution_procs.each do |before_proc|  
        before_proc.call(req, args)  
      end  
  
      log_request # HERE IS THE SINK 1  
  
  
      net.start do |http|  
        if @block_response  
          net_http_do_request(http, req, payload ? payload.to_s : nil,  
                              &@block_response)  
        else  
          res = net_http_do_request(http, req, payload ? payload.to_s : nil) \  
            { |http_response| fetch_body(http_response) }  
          log_response res  
          process_result res, & block  
        end  
      end  
    rescue EOFError  
      raise RestClient::ServerBrokeConnection  
    rescue Timeout::Error, Errno::ETIMEDOUT  
      raise RestClient::RequestTimeout  
  
    rescue OpenSSL::SSL::SSLError => error  
      # TODO: deprecate and remove RestClient::SSLCertificateNotVerified and just  
      # pass through OpenSSL::SSL::SSLError directly.  
      #  
      # Exceptions in verify_callback are ignored [1], and jruby doesn't support  
      # it at all [2]. RestClient has to catch OpenSSL::SSL::SSLError and either  
      # re-throw it as is, or throw SSLCertificateNotVerified based on the  
      # contents of the message field of the original exception.  
      #  
      # The client has to handle OpenSSL::SSL::SSLError exceptions anyway, so  
      # we shouldn't make them handle both OpenSSL and RestClient exceptions.  
      #  
      # [1] https://github.com/ruby/ruby/blob/89e70fe8e7/ext/openssl/ossl.c#L238  
      # [2] https://github.com/jruby/jruby/issues/597  
  
      if error.message.include?("certificate verify failed")  
        raise SSLCertificateNotVerified.new(error.message)  
      else  
        raise error  
      end  
    end  
  
```  
