## Summary:  
Software: jenkins/credentials_binding  
## Fix:  
Commit: https://github.com/jenkinsci/credentials-binding-plugin/commit/59ead11bcb3fd132258d1d7da4a34d47750f40d2  
Change Size: +49 -1  
Author: Jeff Thompson  
Fix Time (of the Last Commit): 2020-04-29  
Fix Pattern: Sanitization -> Redaction -> Enhancement (Corrective Change)  
  
Fixing-commits Count: 1  
Total Change Size: +49 -1  
## Sample logs: No  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> secrets   
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（decorateLogger）  
Sensitiveness-Identifiable Source:  No  
Programming Language:Java  
```Java  
  
// https://github.com/jenkinsci/jenkins/blob/8152129c731472c30fde53618f3ec6e7f3c1c5a6/core/src/main/java/hudson/model/Run.java#L1998-L2015  
  
    private StreamBuildListener createBuildListener(@NonNull RunExecution job, OutputStream logger, Charset charset) throws IOException, InterruptedException {  
        RunT build = job.getBuild();  
  
        // Global log filters  
        for (ConsoleLogFilter filter : ConsoleLogFilter.all()) {  
            logger = filter.decorateLogger(build, logger);  
        }  
  
        // Project specific log filters  
        if (project instanceof BuildableItemWithBuildWrappers && build instanceof AbstractBuild) {  
            BuildableItemWithBuildWrappers biwbw = (BuildableItemWithBuildWrappers) project;  
            for (BuildWrapper bw : biwbw.getBuildWrappersList()) {  
                logger = bw.decorateLogger((AbstractBuild) build, logger);  
            }  
        }  
  
        return new StreamBuildListener(logger,charset);  
    }  
  
// https://github.com/jenkinsci/credentials-binding-plugin/blob/0c75238933365aa52b26b7c73fd1f742bfaca9b1/src/main/java/org/jenkinsci/plugins/credentialsbinding/impl/SecretBuildWrapper.java#L77-L80  
  
    @Override  
    public OutputStream decorateLogger(AbstractBuild build, OutputStream logger) throws IOException, InterruptedException, Run.RunnerAbortedException {  
        return new Filter(build.getCharset().name()).decorateLogger(build, logger);  
    }  
  
// https://github.com/jenkinsci/credentials-binding-plugin/blob/0c75238933365aa52b26b7c73fd1f742bfaca9b1/src/main/java/org/jenkinsci/plugins/credentialsbinding/impl/SecretBuildWrapper.java#L129-L167  
  
    private static final class Filter extends ConsoleLogFilter {  
  
        private final String charsetName;  
  
        Filter(String charsetName) {  
            this.charsetName = charsetName;  
        }  
  
        @Override public OutputStream decorateLogger(final AbstractBuild build, final OutputStream logger) throws IOException, InterruptedException {  
            return new LineTransformationOutputStream() {  
                Pattern p;  
  
                @Override protected void eol(byte[] b, int len) throws IOException {  
                    if (p == null) {  
                        p = getPatternForBuild(build);  
                    }  
  
                    if (p != null && !p.toString().isEmpty()) {  
                        Matcher m = p.matcher(new String(b, 0, len, charsetName));  
                        if (m.find()) {  
                            logger.write(m.replaceAll("****").getBytes(charsetName)); // HERE IS THE SINK 1  
                        } else {  
                            // Avoid byte → char → byte conversion unless we are actually doing something.  
                            logger.write(b, 0, len);  
                        }  
                    } else {  
                        // Avoid byte → char → byte conversion unless we are actually doing something.  
                        logger.write(b, 0, len);  
                    }  
                }  
  
                @Override public void close() throws IOException {  
                    super.close();  
                    logger.close();  
                }  
            };  
        }  
  
    }  
  
```  
