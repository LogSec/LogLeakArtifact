## Summary:  
Software: kubernetes  
## Fix:  
Commit: https://github.com/kubernetes/kubernetes/pull/88684/commits/3784438b566ea3f6dd2d3424150abbfe1e9fd3a1  
Author: Saad Ali  
Fix Time (of the Last Commit): 2020-03-04  
Fix Pattern: Sanitization -> Redaction -> Introduction  
  
  
Fixing-commits Count: 5  
Total Change Size: +695 -148  
  
========  
Master PR: https://github.com/kubernetes/kubernetes/pull/88684  
Commit: https://github.com/saad-ali/kubernetes/commit/22e8189f40fc95b18bad2b59ba2ad20ae7c69ea9  
Change Size: +262 -96  
Time: 2020-03-04  
  
Commit: https://github.com/saad-ali/kubernetes/commit/727582311f6e4211d310fd93fc512d7eb002afa4  
Change Size: +1 -1  
Time: 2020-03-04  
Comment: MISC  
Commit: https://github.com/saad-ali/kubernetes/commit/548b297a0037e4f51811796da51af628f28757a5  
Change Size: +5 -3  
Time: 2020-03-04  
  
Commit: https://github.com/saad-ali/kubernetes/commit/3784438b566ea3f6dd2d3424150abbfe1e9fd3a1  
Change Size: +4 -5  
Time: 2020-03-04  
  
  
sub PR: https://github.com/kubernetes/utils/pull/138  
Commit: https://github.com/saad-ali/utils/commit/e1ea343db90670d7dd3df3a2c7c930b8bf1057ae  
Change Size: +423 -43  
Time: 2020-02-28  
  
## Sample logs: No  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> credential  
### Sink labels:  
#### Sink 1:  
Logging call Function:  Third-party Libaries（k8s.io/klog）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L306，https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L321） -> String Literals（secret）|Variable Names（secret）  
#### Sink 2:  
Logging call Function:  Third-party Libaries（k8s.io/klog）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L306，https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L321） -> String Literals（secret）|Variable Names（secret）  
#### Sink 3:  
Logging call Function:  Third-party Libaries（k8s.io/klog）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L306，https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L321） -> String Literals（secret）|Variable Names（secret）  
#### Sink 4:  
Logging call Function:  Third-party Libaries（k8s.io/klog）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L306，https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L321） -> String Literals（secret）|Variable Names（secret）  
#### Sink 5:  
Logging call Function:  Standard Libraries（fmt.Errorf）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L306，https://github.com/saad-ali/kubernetes/blob/3aa59f7f3077642592dc8a864fcef8ba98699894/pkg/volume/cephfs/cephfs.go#L321） -> String Literals（secret）|Variable Names（secret）  
Programming Language:Go  
```Go  
  
// https://github.com/saad-ali/utils/blob/e1ea343db90670d7dd3df3a2c7c930b8bf1057ae/mount/mount_linux.go#L395-L401  
    if err != nil {  
        // Do not log sensitiveOptions only options  
        sensitiveOptionsLog := sanitizedOptionsForLogging(options, sensitiveOptions)  
        detailedErr := fmt.Sprintf("format of disk %q failed: type:(%q) target:(%q) options:(%q) errcode:(%v) output:(%v) ", source, fstype, target, sensitiveOptionsLog, err, string(output))  
        klog.Error(detailedErr) // HERE IS THE SINK 1  
        return NewMountError(FormatFailed, detailedErr)  
    }  
  
// https://github.com/saad-ali/utils/blob/e1ea343db90670d7dd3df3a2c7c930b8bf1057ae/mount/mount_windows.go#L64-L123  
func (mounter *Mounter) MountSensitive(source string, target string, fstype string, options []string, sensitiveOptions []string) error {  
	target = NormalizeWindowsPath(target)  
	sanitizedOptionsForLogging := sanitizedOptionsForLogging(options, sensitiveOptions)  
  
	if source == "tmpfs" {  
		klog.V(3).Infof("mounting source (%q), target (%q), with options (%q)", source, target, sanitizedOptionsForLogging) // HERE IS THE SINK 2  
		return os.MkdirAll(target, 0755)  
	}  
  
	parentDir := filepath.Dir(target)  
	if err := os.MkdirAll(parentDir, 0755); err != nil {  
		return err  
	}  
  
	klog.V(4).Infof("mount options(%q) source:%q, target:%q, fstype:%q, begin to mount",  
		sanitizedOptionsForLogging, source, target, fstype) // HERE IS THE SINK 3  
	bindSource := source  
  
	// tell it's going to mount azure disk or azure file according to options  
	if bind, _, _, _ := MakeBindOpts(options, sensitiveOptions); bind {  
		// mount azure disk  
		bindSource = NormalizeWindowsPath(source)  
	} else {  
		if len(options) < 2 {  
			klog.Warningf("mount options(%q) command number(%d) less than 2, source:%q, target:%q, skip mounting",  
				sanitizedOptionsForLogging, len(options), source, target) // HERE IS THE SINK 4  
			return nil  
		}  
  
		// currently only cifs mount is supported  
		if strings.ToLower(fstype) != "cifs" {  
			return fmt.Errorf("only cifs mount is supported now, fstype: %q, mounting source (%q), target (%q), with options (%q)", fstype, source, target, sanitizedOptionsForLogging)  // HERE IS THE SINK 5  
		}  
  
		// lock smb mount for the same source  
		getSMBMountMutex.LockKey(source)  
		defer getSMBMountMutex.UnlockKey(source)  
  
		if output, err := newSMBMapping(options[0], options[1], source); err != nil {  
			if isSMBMappingExist(source) {  
				klog.V(2).Infof("SMB Mapping(%s) already exists, now begin to remove and remount", source)  
				if output, err := removeSMBMapping(source); err != nil {  
					return fmt.Errorf("Remove-SmbGlobalMapping failed: %v, output: %q", err, output)  
				}  
				if output, err := newSMBMapping(options[0], options[1], source); err != nil {  
					return fmt.Errorf("New-SmbGlobalMapping remount failed: %v, output: %q", err, output)  
				}  
			} else {  
				return fmt.Errorf("New-SmbGlobalMapping failed: %v, output: %q", err, output)  
			}  
		}  
	}  
  
	if output, err := exec.Command("cmd", "/c", "mklink", "/D", target, bindSource).CombinedOutput(); err != nil {  
		klog.Errorf("mklink failed: %v, source(%q) target(%q) output: %q", err, bindSource, target, string(output))  
		return err  
	}  
  
	return nil  
}  
  
  
// https://github.com/saad-ali/utils/blob/e1ea343db90670d7dd3df3a2c7c930b8bf1057ae/mount/mount.go#L349-L370  
  
// sanitizedOptionsForLogging will return a comma seperated string containing  
// options and sensitiveOptions. Each entry in sensitiveOptions will be  
// replaced with the string sensitiveOptionsRemoved  
// e.g. o1,o2,<masked>,<masked>  
func sanitizedOptionsForLogging(options []string, sensitiveOptions []string) string {  
	seperator := ""  
	if len(options) > 0 && len(sensitiveOptions) > 0 {  
		seperator = ","  
	}  
  
	sensitiveOptionsStart := ""  
	sensitiveOptionsEnd := ""  
	if len(sensitiveOptions) > 0 {  
		sensitiveOptionsStart = strings.Repeat(sensitiveOptionsRemoved+",", len(sensitiveOptions)-1)  
		sensitiveOptionsEnd = sensitiveOptionsRemoved  
	}  
  
	return strings.Join(options, ",") +  
		seperator +  
		sensitiveOptionsStart +  
		sensitiveOptionsEnd  
}  
  
```  
