## Summary:  
Software: openstack/ceilometer  
## Fix:  
Commit: https://github.com/openstack/ceilometer/commit/ef6c659588feff646343fd80ba3d420d9c06404b  
Change Size: +4 -2  
Author: Julien Danjou  
Fix Time (of the Last Commit): 2013-10-30  
Fix Pattern: Remove -> Logging Variables  
MISC: Review: https://review.opendev.org/c/openstack/ceilometer/+/56396  
Fixing-commits Count: 1  
Total Change Size: +4 -2  
## Sample logs: Yes  
```  
2013-10-22 15:33:41.244 10537 INFO ceilometer.storage.impl_db2 [-] connecting to MongoDB on mongodb://ceilometer:fe85b844214814b95a0b@127.0.0.1:27017/ceilometer  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> connection string; the DB2 or MongoDB password  
### Sink labels:  
#### Sink 1:  
Logging call Function:  User-defined（ContextAdapter.info）  
Sensitiveness-Identifiable Source:  Same Methods & Cross Statements（邻近，https://github.com/openstack/ceilometer/blob/7ad530b671b5b5200967092b4bec4f0236b1656e/ceilometer/storage/impl_db2.py#L148）-> String Literals（password，finally outputed to logs）  
#### Sink 2:  
Logging call Function:  User-defined（ContextAdapter.info）  
Sensitiveness-Identifiable Source:  Same Methods & Cross Statements（https://github.com/openstack/ceilometer/blob/7ad530b671b5b5200967092b4bec4f0236b1656e/ceilometer/storage/impl_db2.py#L148）-> String Literals（password，finally outputed to logs）  
Programming Language:Python  
```Python  
# https://github.com/openstack/ceilometer/blob/7ad530b671b5b5200967092b4bec4f0236b1656e/ceilometer/storage/impl_db2.py#L139-L161  
  
class ConnectionPool(object):  
  
    def __init__(self):  
        self._pool = {}  
  
    def connect(self, url):  
        connection_options = pymongo.uri_parser.parse_uri(url)  
        del connection_options['database']  
        del connection_options['username']  
        del connection_options['password']  
        del connection_options['collection']  
        pool_key = tuple(connection_options)  
  
        if pool_key in self._pool:  
            client = self._pool.get(pool_key)()  
            if client:  
                return client  
        LOG.info('connecting to MongoDB on %s', url) # HERE IS THE SINK 1  
        client = pymongo.MongoClient(  
            url,  
            safe=True)  
        self._pool[pool_key] = weakref.ref(client)  
        return client  
  
# https://github.com/openstack/ceilometer/blob/7ad530b671b5b5200967092b4bec4f0236b1656e/ceilometer/storage/impl_mongodb.py#L141-L163  
class ConnectionPool(object):  
  
    def __init__(self):  
        self._pool = {}  
  
    def connect(self, url):  
        connection_options = pymongo.uri_parser.parse_uri(url)  
        del connection_options['database']  
        del connection_options['username']  
        del connection_options['password']  
        del connection_options['collection']  
        pool_key = tuple(connection_options)  
  
        if pool_key in self._pool:  
            client = self._pool.get(pool_key)()  
            if client:  
                return client  
        LOG.info('connecting to MongoDB on %s', url) # HERE IS THE SINK 2  
        client = pymongo.MongoClient(  
            url,  
            safe=True)  
        self._pool[pool_key] = weakref.ref(client)  
        return client  
  
  
# https://github.com/openstack/ceilometer/blob/7ad530b671b5b5200967092b4bec4f0236b1656e/ceilometer/storage/impl_mongodb.py#L166-L326  
class Connection(base.Connection):  
    """MongoDB connection.  
    """  
  
    CONNECTION_POOL = ConnectionPool()  
  
# OMIT FOR SIMPLICITY  
    def __init__(self, conf):  
        url = conf.database.connection  
  
        # NOTE(jd) Use our own connection pooling on top of the Pymongo one.  
        # We need that otherwise we overflow the MongoDB instance with new  
        # connection since we instanciate a Pymongo client each time someone  
        # requires a new storage connection.  
        self.conn = self.CONNECTION_POOL.connect(url)  
  
        # Require MongoDB 2.2 to use aggregate() and TTL  
        if self.conn.server_info()['versionArray'] < [2, 2]:  
            raise storage.StorageBadVersion("Need at least MongoDB 2.2")  
  
        connection_options = pymongo.uri_parser.parse_uri(url)  
        self.db = getattr(self.conn, connection_options['database'])  
        if connection_options.get('username'):  
            self.db.authenticate(connection_options['username'],  
                                 connection_options['password'])  
  
        # NOTE(jd) Upgrading is just about creating index, so let's do this  
        # on connection to be sure at least the TTL is correcly updated if  
        # needed.  
        self.upgrade()  
  
  
# https://github.com/openstack/ceilometer/blob/7ad530b671b5b5200967092b4bec4f0236b1656e/ceilometer/api/v1/app.py#L35-L68  
  
def make_app(conf, enable_acl=True, attach_storage=True,  
             sources_file='sources.json'):  
    app = flask.Flask('ceilometer.api')  
    app.register_blueprint(v1_blueprint.blueprint, url_prefix='/v1')  
  
    app.json_encoder = JSONEncoder  
  
    try:  
        with open(sources_file, "r") as f:  
            sources = jsonutils.load(f)  
    except IOError:  
        sources = {}  
  
    @app.before_request  
    def attach_config():  
        flask.request.cfg = conf  
        flask.request.sources = sources  
  
    if attach_storage:  
        @app.before_request  
        def attach_storage():  
            storage_engine = storage.get_engine(conf)  
            flask.request.storage_engine = storage_engine  
            flask.request.storage_conn = \  
                storage_engine.get_connection(conf)  
  
    # Install the middleware wrapper  
    if enable_acl:  
        app.wsgi_app = acl.install(app.wsgi_app, conf)  
  
    return app  
  
# For documentation  
app = make_app(cfg.CONF, enable_acl=False, attach_storage=False) # HERE IS THE SOURCE  
  
```  
