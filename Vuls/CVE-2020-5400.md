## Summary:  
Software: cloud_foundry/cloud_controller  
## Fix:  
Commit: https://github.com/cloudfoundry/cloud_controller_ng/commit/3862ea556d3b3d11b705ffa6dcd5bb96011ea9a3  
Author: braa braa braa  
Fix Time (of the Last Commit): 2020-02-12  
Fix Pattern: Remove -> Logging Variables  
  
  
Fixing-commits Count: 2  
Total Change Size: +16 -2  
  
========  
Commit: https://github.com/alphagov/paas-cf/commit/48e814895d20704acb130cbc0b7a789ea691964a  
Change Size: +14 -0  
Time: 2020-02-12  
Comment: add script to filter leaked passwords  
Commit: https://github.com/cloudfoundry/cloud_controller_ng/commit/3862ea556d3b3d11b705ffa6dcd5bb96011ea9a3  
Change Size: +2 -2  
Time: 2020-02-12  
Comment: remove logging variable / add test case  
## Sample logs: Yes  
```  
about to run job #<VCAP::CloudController::Jobs::Services::ServiceInstanceStateFetch:someguid @name="service-instance-state-fetch", @service_instance_guid="someguid", @request_attrs={"name"=>"name-4476", "space_guid"=>"11f9c598-9610-454f-acc6-215104a855b5", service_plan_guid"=>nil, "parameters"=>{"helloworld"=>false, "secondparameter"=>"cloud", "memory"=>"2", "sourceip"=>"0.0.0.0/0", "SomeSensitivePassword"=>"THIS IS MY PASSWORD", "somemorevars"=>"bla"}, "tags"=>[]}, @end_timestamp=2019-11-29 13:23:00 +0000  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> sensitive information such as credentials  
### Sink labels:  
#### Sink 1:  
Logging call Function:  Third-party Libaries（CloudFoundry Steno Logging）  
Sensitiveness-Identifiable Source:  Same Modules & Cross Files（https://github.com/cloudfoundry/cloud_controller_ng/blob/4a23a419862ef9b7272f411a4435e33fc7305f30/app/actions/service_broker_create.rb#L21）-> String Literals（auth_password）|Variable Names（password）  
Programming Language:Ruby  
```Ruby  
# https://github.com/cloudfoundry/cloud_controller_ng/blob/4f3b7bdb13e5cb22906e2627e9c34070df312239/app/jobs/logging_context_job.rb#L4-L21  
  
module VCAP::CloudController  
  module Jobs  
    class LoggingContextJob < WrappingJob  
      attr_reader :request_id  
  
      def initialize(handler, request_id)  
        super(handler)  
        @request_id = request_id  
      end  
  
      def perform  
        with_request_id_set do  
          logger.info("about to run job #{wrapped_handler.inspect}") # HERE IS THE SINK 1  
          super  
        end  
      rescue CloudController::Blobstore::BlobstoreError => e  
        raise CloudController::Errors::ApiError.new_from_details('BlobstoreError', e.message)  
      end  
  
  
# https://github.com/cloudfoundry/cloud_controller_ng/blob/4a23a419862ef9b7272f411a4435e33fc7305f30/app/jobs/enqueuer.rb#L8-L66  
module VCAP::CloudController  
  module Jobs  
    class Enqueuer  
      def initialize(job, opts={})  
        @job = job  
        @opts = opts  
        @timeout_calculator = JobTimeoutCalculator.new(VCAP::CloudController::Config.config)  
        load_delayed_job_plugins  
      end  
  
      def enqueue  
        enqueue_job(@job)  
      end  
  
      # OMIT FOR SIMPLICITY  
      def enqueue_job(job)  
        @opts['guid'] = SecureRandom.uuid  
        request_id = ::VCAP::Request.current_id  
        timeout_job = TimeoutJob.new(job, job_timeout)  
        logging_context_job = LoggingContextJob.new(timeout_job, request_id)  
        Delayed::Job.enqueue(logging_context_job, @opts)  
      end  
  
# https://github.com/cloudfoundry/cloud_controller_ng/blob/4a23a419862ef9b7272f411a4435e33fc7305f30/app/actions/services/service_instance_create.rb#L4-L64  
  
module VCAP::CloudController  
  class ServiceInstanceCreate  
    def initialize(services_event_repository, logger)  
      @services_event_repository = services_event_repository  
      @logger = logger  
    end  
  
    # OMIT FOR SIMPLICITY  
    def setup_async_job(request_attrs, service_instance)  
      job = VCAP::CloudController::Jobs::Services::ServiceInstanceStateFetch.new(  
        'service-instance-state-fetch',  
        service_instance.guid,  
        @services_event_repository.user_audit_info,  
        request_attrs,  
      )  
      enqueuer = Jobs::Enqueuer.new(job, queue: Jobs::Queues.generic)  
      enqueuer.enqueue  
      @services_event_repository.record_service_instance_event(:start_create, service_instance, request_attrs)  
    end  
  
```  
