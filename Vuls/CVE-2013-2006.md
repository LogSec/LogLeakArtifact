## Summary:  
Software: openstack/keystone  
## Fix:  
Commit: https://github.com/openstack/keystone/commit/c5037dd6b82909efaaa8720e8cfa8bdb8b4a0edd  
Change Size: +2 -2  
Author: Xuhan Peng  
Fix Time (of the Last Commit): 2013-05-02  
Fix Pattern: Sanitization -> Redaction -> Reuse -> TagBasedFiltration  
  
Fixing-commits Count: 1  
Total Change Size: +2 -2  
  
  
Review: https://review.opendev.org/c/openstack/keystone/+/26826/  
## Sample logs: Yes  
```  
(keystone-all): 2013-04-23 23:17:09,101 DEBUG cfg log_opt_values admin_token = 111222333444  
(keystone-all): 2013-04-23 23:17:09,108 DEBUG cfg log_opt_values ldap.password = None  
```  
## Logging statements:  
### Source labels:  
Type of Sensitive Information:authentication data -> admin_token; LDAP password  
### Sink labels:  
#### Sink 1:  
Logging call Function:  Third-party Libaries（OpenStack oslo.config中的ConfigOpts.log_opt_values）  
Sensitiveness-Identifiable Source:  Same Projects & Cross Modules（https://github.com/openstack/keystone/blob/c5037dd6b82909efaaa8720e8cfa8bdb8b4a0edd/keystone/common/config.py#L191） -> String Literals（admin_token，finally outputed to logs）  
Programming Language:Python  
```python  
  
# https://github.com/openstack/keystone/blob/d43e2a51a1ed7adbed3c5ddf001d46bc4a824ae8/bin/keystone-all#L73-L123  
  
if __name__ == '__main__':  
    dev_conf = os.path.join(possible_topdir,  
                            'etc',  
                            'keystone.conf')  
    config_files = None  
    if os.path.exists(dev_conf):  
        config_files = [dev_conf]  
  
    CONF(project='keystone',  
         version=version.VersionInfo('keystone').version_string(),  
         default_config_files=config_files)  
  
    config.setup_logging(CONF)  
  
    # Log the options used when starting if we're in debug mode...  
    if CONF.debug:  
        CONF.log_opt_values(logging.getLogger(CONF.prog), logging.DEBUG) # HERE IS THE SINK 1  
  
    if CONF.config_file:  
        paste_config = CONF.config_file[0]  
    else:  
        paste_config = CONF.find_file('keystone.conf')  
        if not paste_config:  
            print ("The keystone.conf file could not be found in the "  
                   "configuration directories.")  
            CONF.print_help()  
            sys.exit(1)  
  
    monkeypatch_thread = not CONF.standard_threads  
    pydev_debug_url = utils.setup_remote_pydev_debug()  
    if pydev_debug_url:  
        # in order to work around errors caused by monkey patching we have to  
        # set the thread to False.  An explanation is here:  
        # http://lists.openstack.org/pipermail/openstack-dev/2012-August/  
        # 000794.html  
        monkeypatch_thread = False  
    eventlet.patcher.monkey_patch(all=False, socket=True, time=True,  
                                  thread=monkeypatch_thread)  
  
    options = deploy.appconfig('config:%s' % paste_config)  
  
    servers = []  
    servers.append(create_server(paste_config,  
                                 'admin',  
                                 CONF.bind_host,  
                                 int(CONF.admin_port)))  
    servers.append(create_server(paste_config,  
                                 'main',  
                                 CONF.bind_host,  
                                 int(CONF.public_port)))  
    serve(*servers)  
  
# https://github.com/openstack/keystone/blob/c5037dd6b82909efaaa8720e8cfa8bdb8b4a0edd/keystone/config.py#L16-L22  
"""Wrapper for keystone.common.config that configures itself on import."""  
  
from keystone.common import config  
  
  
config.configure()  
CONF = config.CONF  
  
  
# https://github.com/openstack/keystone/blob/c5037dd6b82909efaaa8720e8cfa8bdb8b4a0edd/keystone/common/config.py#L182-L377  
  
def configure():  
    # OMIT FOR SIMPLICITY  
    register_str('admin_token', secret=True, default='ADMIN')  
    # OMIT FOR SIMPLICITY  
  
```  
```python  
  
# https://github.com/openstack/oslo.config/blob/59b672033919bb315f2673ed1f417787ca4c042e/oslo/config/cfg.py#L1133-L1181  
    def __call__(self,  
                 args=None,  
                 project=None,  
                 prog=None,  
                 version=None,  
                 usage=None,  
                 default_config_files=None):  
        """Parse command line arguments and config files.  
        Calling a ConfigOpts object causes the supplied command line arguments  
        and config files to be parsed, causing opt values to be made available  
        as attributes of the object.  
        The object may be called multiple times, each time causing the previous  
        set of values to be overwritten.  
        Automatically registers the --config-file option with either a supplied  
        list of default config files, or a list from find_config_files().  
        If the --config-dir option is set, any *.conf files from this  
        directory are pulled in, after all the file(s) specified by the  
        --config-file option.  
        :param args: command line arguments (defaults to sys.argv[1:])  
        :param project: the toplevel project name, used to locate config files  
        :param prog: the name of the program (defaults to sys.argv[0] basename)  
        :param version: the program version (for --version)  
        :param usage: a usage string (%prog will be expanded)  
        :param default_config_files: config files to use by default  
        :returns: the list of arguments left over after parsing options  
        :raises: SystemExit, ConfigFilesNotFoundError, ConfigFileParseError,  
                 RequiredOptError, DuplicateOptError  
        """  
  
        self.clear()  
  
        prog, default_config_files = self._pre_setup(project,  
                                                     prog,  
                                                     version,  
                                                     usage,  
                                                     default_config_files)  
  
        self._setup(project, prog, version, usage, default_config_files)  
  
        self._cli_values = self._parse_cli_opts(args) # HERE IS THE SOURCE  
  
        self._parse_config_files() # HERE IS THE SOURCE  
  
        self._check_required_opts()  
  
# https://github.com/openstack/oslo.config/blob/59b672033919bb315f2673ed1f417787ca4c042e/oslo/config/cfg.py#L1461-L1494  
  
    def log_opt_values(self, logger, lvl):  
        """Log the value of all registered opts.  
        It's often useful for an app to log its configuration to a log file at  
        startup for debugging. This method dumps to the entire config state to  
        the supplied logger at a given log level.  
        :param logger: a logging.Logger object  
        :param lvl: the log level (e.g. logging.DEBUG) arg to logger.log()  
        """  
        logger.log(lvl, "*" * 80)  
        logger.log(lvl, "Configuration options gathered from:")  
        logger.log(lvl, "command line args: %s", self._args)  
        logger.log(lvl, "config files: %s", self.config_file)  
        logger.log(lvl, "=" * 80)  
  
        def _sanitize(opt, value):  
            """Obfuscate values of options declared secret"""  
            return value if not opt.secret else '*' * len(str(value))  
  
        for opt_name in sorted(self._opts):  
            opt = self._get_opt_info(opt_name)['opt']  
            logger.log(lvl, "%-30s = %s", opt_name,  
                       _sanitize(opt, getattr(self, opt_name))) # HERE IS THE INNER SINK 1  
  
        for group_name in self._groups:  
            group_attr = self.GroupAttr(self, self._get_group(group_name))  
            for opt_name in sorted(self._groups[group_name]._opts):  
                opt = self._get_opt_info(opt_name, group_name)['opt']  
                logger.log(lvl, "%-30s = %s",  
                           "%s.%s" % (group_name, opt_name),  
                           _sanitize(opt, getattr(group_attr, opt_name)))  
  
        logger.log(lvl, "*" * 80)  
  
  
```  
